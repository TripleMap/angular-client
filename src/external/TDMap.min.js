!function(e){function t(r){if(i[r])return i[r].exports;var a=i[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.Promises=function(){function e(){r(this,e)}return a(e,[{key:"getPromise",value:function(e,t,i){var r={url:e,type:"GET"};return null!==t&&void 0!==t&&(r.params=t),null!==i&&void 0!==i&&(r.headers=i),$.get(r)}}]),e}()},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.TDMap=void 0;var a=i(2),o=i(3),n=i(0),s=i(4),l=i(5),d=i(6),h=i(9),u=i(10),p=i(11),c=i(12),f=function e(){r(this,e),this.Service={GeoJSONServiceLayer:h.GeoJSONServiceLayer,YandexProvider:p.YandexProvider,RosreestrProvider:c.RosreestrProvider,googleMutant:u.googleMutant},this.Layers={},this.Utils={GeoUtil:a.GeoUtil,MeasurmentUtils:o.MeasurmentUtils,Measurment:o.Measurment,Promises:n.Promises,SpatialFilterUtils:l.SpatialFilterUtils,SpatialFilter:l.SpatialFilter,CadastrSearchProviderPPK5:s.CadastrSearchProviderPPK5,CadastrSearchPPK5:s.CadastrSearchPPK5},this.Routing=d.Routing},g=t.TDMap=new f;window.TDMap=g},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoUtil=L.Util.extend({intersectionByBBox:function(e,t,i){this.map=i;var r=this.parseResult(this.isMultiPointInsideBBox(e,t));return"within"===r||"overlaps"===r},isMultiPointInsideBBox:function(e,t){for(var i=[],r=0;r<e.length;r++)i.push(this.pointIntersectionMath(e[r],t));return i},pointIntersectionMath:function(e,t){for(var i=e[0],r=e[1],a=!1,o=0,n=t.length-1;o<t.length;n=o++){var s=t[o][0],l=t[o][1],d=t[n][0],h=t[n][1];l>r!=h>r&&i<(d-s)*(r-l)/(h-l)+s&&(a=!a)}return a},parseResult:function(e){return!0===e&&"boolean"==typeof e?"within":!1===e&&"boolean"==typeof e?"no intersects":e.constructor===Array?(e.sort(),e[0]===e[e.length-1]&&!0===e[0]?"within":e[0]===e[e.length-1]&&!1===e[0]?"no intersects":"overlaps"):void 0}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=t.MeasurmentUtils={};r.MeasureLine=L.Polyline.extend({options:{className:"leaflet-interactive measurment-line"}}),r.MeasurePolygon=L.Polygon.extend({options:{className:"leaflet-interactive measurment-polygon"}}),r.MeasureVertex=L.Editable.VertexMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon measurment-edge"},onAdd:function(e){L.Editable.VertexMarker.prototype.onAdd.call(this,e),this.on("mouseover",this.mouseover),this.on("mouseout",this.mouseout)},mouseover:function(e){this.editor.fireAndForward("editable:vertex:mouseover",e)},mouseout:function(e){this.editor.fireAndForward("editable:vertex:mouseout",e)}}),r.MeasureMiddleVertex=L.Editable.MiddleMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon measurment-middleEdge"},onAdd:function(e){L.Editable.MiddleMarker.prototype.onAdd.call(this,e),this.on("mouseover",this.mouseover),this.on("mouseout",this.mouseout)},mouseover:function(e){e.left=this.left,e.right=this.right,this.editor.fireAndForward("editable:middlemarker:mouseover",e)},mouseout:function(e){e.middleMarkerId=this._leaflet_id,this.editor.fireAndForward("editable:middlemarker:mouseout",e)}}),t.Measurment=L.Editable.extend({options:{vertexMarkerClass:r.MeasureVertex,polylineClass:r.MeasureLine,polygonClass:r.MeasurePolygon,middleMarkerClass:r.MeasureMiddleVertex,lineGuideOptions:{className:"measurment-lineguide"}},initialize:function(e,t){L.Editable.prototype.initialize.call(this,e),L.setOptions(this,t),e.measureTools=this,this.map=e;var i=this;e.on("stopmeasure",function(){var e;i.abortDrawing();for(var t in i.featuresLayer._layers)e=i.featuresLayer._layers[t]._leaflet_id;i.removeLabel(e),i.featuresLayer.remove(),i.map.off("zoomend",i.dravingZoomEnd)},this)},disableMapZoom:function(){this.map.doubleClickZoom&&this.map.doubleClickZoom.disable(),this.map.touchZoom&&this.map.touchZoom.disable()},enableMapZoom:function(){this.map.doubleClickZoom||this.map.doubleClickZoom.enable(),this.map.touchZoom||this.map.touchZoom.enable()},abortDrawing:function(){this.off("editable:vertex:mouseover editable:vertex:mouseout editable:middlemarker:mouseover editable:middlemarker:mouseout editable:vertex:drag editable:vertex:dragend editable:drawing:move",this.preMeasureCookLayer),this.off("editable:vertex:drag editable:vertex:dragend editable:drawing:move editable:vertex:mouseover editable:vertex:mouseout editable:middlemarker:mouseout",this.preMeasureCookLayer),this.off("editable:drawing:end",this.dravingLineEnd),this.off("editable:drawing:end",this.dravingPolygonEnd),this.enableMapZoom(),this.stopDrawing()},startPolylineMeasure:function(){this.disableMapZoom(),this.on("editable:vertex:mouseover editable:vertex:mouseout editable:middlemarker:mouseover editable:middlemarker:mouseout editable:vertex:drag editable:vertex:dragend editable:drawing:move",this.preMeasureCookLayer),this.on("editable:drawing:end",this.dravingLineEnd),L.Editable.prototype.startPolyline.call(this)},dravingLineEnd:function(e){this.off("editable:drawing:move",this.preMeasureCookLayer),this.preMeasureCookLayer(e),this.enableMapZoom(),this.map.on("zoomend",this.dravingZoomEnd)},startPolygonMeasure:function(){this.disableMapZoom(),this.on("editable:vertex:drag editable:vertex:dragend editable:drawing:move editable:vertex:mouseover editable:vertex:mouseout editable:middlemarker:mouseout",this.preMeasureCookLayer),this.on("editable:drawing:end",this.dravingPolygonEnd),L.Editable.prototype.startPolygon.call(this)},dravingPolygonEnd:function(e){var t=this;t.off("editable:drawing:move",t.preMeasureCookLayer),t.preMeasureCookLayer(e),t.enableMapZoom(),t.map.on("zoomend",this.dravingZoomEnd),t.on("editable:middlemarker:mouseover",t.preMeasureCookLineLayer)},dravingZoomEnd:function(e){for(var t in e.target.measureTools.featuresLayer._layers)e.layer=e.target.measureTools.featuresLayer._layers[t],e.layer.toGeoJSON().geometry.type,e.target.measureTools.preMeasureCookLayer(e)},preMeasureCookLayer:function(e){"Polygon"===(e.layer||e.target).toGeoJSON().geometry.type?e.target.measureTools?e.target.measureTools.preMeasureCookPolygonLayer(e):e.editTools.preMeasureCookPolygonLayer(e):e.target.measureTools?e.target.measureTools.preMeasureCookLineLayer(e):e.editTools.preMeasureCookLineLayer(e)},preMeasureCookLineLayer:function(e){for(var t,i=e.layer,r=this._getLineLatLngs(i),a=[],o=[],n=0;n<r.length;n++)a.push(r[n]);if(this.removeLabel(i._leaflet_id),"editable:drawing:move"===e.type){var s=e.latlng;t=e.layerPoint,a.push(s)}else if("editable:drawing:end"===e.type||"editable:vertex:dragend"===e.type||"editable:vertex:mouseout"===e.type||"editable:middlemarker:mouseout"===e.type)t=i._rings[0][i._rings[0].length-1];else if("editable:vertex:drag"===e.type)t=e.vertex.dragging._draggable._newPos;else if("editable:vertex:mouseover"===e.type){t=e.layerPoint;for(var l,d=0;d<i._rings[0].length;d++)i._rings[0][d].x===t.x&&i._rings[0][d].y===t.y&&(l=d);o=[];for(var h=0;h<r.length;h++)h-1<l&&o.push(r[h]);a=o}else"editable:middlemarker:mouseover"===e.type&&(t=e.layerPoint,o=[],o.push(e.left.latlng),o.push(e.right.latlng),a=o);if(!(a.length<1)){var u=this;"zoomend"===e.type?setTimeout(function(){u.createMouseMoveLabel({pathLength:u._getPerimeter(a)},i._rings[0][i._rings[0].length-1],i._leaflet_id)},50):this.createMouseMoveLabel({pathLength:u._getPerimeter(a)},t,i._leaflet_id)}},preMeasureCookPolygonLayer:function(e){for(var t,i=this,r=e.layer||e.target,a=this._getLineLatLngs(r),o=[],n=!1,s=0;s<a[0].length;s++)o.push(a[0][s]);if("editable:drawing:move"===e.type){var l=e.latlng;t=e.layerPoint||e.vertex.dragging._draggable._newPos,o.push(l),void 0!==a[0][a.length-1]&&o.push(a[0][a.length-1])}else"editable:drawing:end"===e.type?(t=i.map.latLngToContainerPoint(r.getCenter()),o.push(a[0][a.length-1]),n=!0):"editable:vertex:drag"===e.type?(t=e.vertex.dragging._draggable._newPos,o.push(a[0][a.length-1])):"editable:vertex:mouseover"===e.type&&(t=e.layerPoint,o.push(a[0][a.length-1]));o.length<2||("zoomend"===e.type||"editable:vertex:mouseout"===e.type||"editable:middlemarker:mouseout"===e.type||"editable:vertex:dragend"===e.type?(this.removeLabel(r._leaflet_id),setTimeout(function(){var e=$(".leaflet-map-pane").css("transform").replace("(",",").replace(")","").split(",");t=i.map.latLngToContainerPoint(r.getCenter()),t.x=t.x-e[e.length-2],t.y=t.y-e[e.length-1],o.push(a[0][a.length-1]),i.removeLabel(r._leaflet_id),n=!0,i.createMouseMoveLabel({pathLength:i._getPerimeter(o),pathSquare:i.getArea(o),screenCordsShift:n},t,r._leaflet_id)},50)):(this.removeLabel(r._leaflet_id),this.createMouseMoveLabel({pathLength:i._getPerimeter(o),pathSquare:i.getArea(o),screenCordsShift:n},t,r._leaflet_id)))},_getLineLatLngs:function(e){return e.editor.getLatLngs()},getDistance:function(e){return e.latlng1.distanceTo(e.latlng2)},_getPerimeter:function(e){for(var t=0,i=0,r=1;r<e.length;r++){var a=e[r-1],o=e[r];i=this.getDistance({latlng1:a,latlng2:o}),t+=Number(i)}return this.readableDistance(t)},getArea:function(e){var t=parseFloat(this.geodesicArea(e));return this.readableArea(t)},geodesicArea:function(e){var t,i,r=e.length,a=0,o=.017453292519943295;if(r>2){for(var n=0;n<r;n++)t=e[n],i=e[(n+1)%r],a+=(i.lng-t.lng)*o*(2+Math.sin(t.lat*o)+Math.sin(i.lat*o));a=6378137*a*6378137/2}return Math.abs(a)},readableDistance:function(e){return e>1e4?L.Util.template("{distance} км",{distance:(e/1e3).toFixed(3)}):L.Util.template("{distance} м",{distance:(e/1).toFixed(1)})},readableArea:function(e){function t(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),t.join(".")}var i=L.Util.template("{area} м²",{area:e.toFixed(0)});i=t(i);var r=e/1e4,a=L.Util.template("{gaArea} Га",{gaArea:r.toFixed(2)});return a=t(a),i+" / "+a},createMouseMoveLabel:function(e,t,i){function r(e,t){e.each(function(){for(var e=d3.select(this),i=a.split("_"),r=!0,o=[],n=0,s=e.attr("x"),l=e.attr("y"),d=e.text(null).append("tspan").attr("x",s).attr("y",l).attr("dy","0em");r;)r=i.pop(),o.push(r),d.text(o.join(" ")),d.node().getComputedTextLength()>t&&(o.pop(),d.text(o.join("/")),o=[r],d=e.append("tspan").attr("x",s).attr("y",l).attr("dy",1.1*++n+0+"em").text(r))})}var a,o=0,n=0;if(e.pathLength&&(a="Расстояние: "+e.pathLength),e.pathSquare&&(a="Периметр: "+e.pathLength,a=a+"_Площадь: "+e.pathSquare),e.screenCordsShift&&(o=-75,n=15),void 0!==a){var s,l=d3.select(".leaflet-overlay-pane").select("svg").append("g").attr("class","measurment"+i),d=l.append("rect"),h=l.append("text").attr("x",t.x+25+o).attr("y",t.y-15+n).attr("class","measurment-label-text").call(r,180);if(null!==h.node()){s=h.node().getBBox();var u=s.width+6,p=s.height+2;d.attr("class","leaflet-measure-label-rectangle").attr("width",u+5).attr("height",p).attr("x",s.x-5).attr("y",s.y-1).style("fill","white").style("fill-opacity",.5).style("stroke","#3f51b5").style("stroke-width","1px").style("stroke-opacity",1)}}},removeLabel:function(e){$(".measurment"+e).remove()},checkAndClearAllLabels:function(){$("[class^='measurment']").remove()}})},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=t.CadastrSearchProviderPPK5=function(){function e(t){r(this,e),this.map=t}return a(e,[{key:"getDataByMask",value:function(e){}},{key:"getDataByMaskAsynch",value:function(e){var t=$.Deferred();return function(){function i(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var r={text:e,tolerance:"16391",limit:16,callback:"JQuery"+i()+i()},a=[],o=[];this[r.callback]=function(e){};var n=Number(e.split(":")[0]).toString()+":"+Number(e.split(":")[1]).toString()+":"+Number(e.split(":")[2]).toString()+":"+Number(e.split(":")[3]).toString();$.ajax({url:"https://pkk5.rosreestr.ru/api/features/1/"+n,type:"GET",dataType:"jsonp",success:function(e){if(void 0!==e.feature&&null!==e.feature)if(e.feature.center&&e.feature.extent){var i=L.Projection.SphericalMercator.unproject(L.point(e.feature.center.x,e.feature.center.y)),r={type:"Feature",geojson:{type:"Point",coordinates:[i[Object.keys(i)[1]],i[Object.keys(i)[0]]]}};r.properties=e.feature.attrs,r.properties.extent=e.feature.extent,r.properties.center=e.feature.center,a.push(r),t.resolve(a,"withCoords")}else o.push({type:"Feature",properties:{cn:e.feature.attrs.cn,id:e.feature.attrs.id}}),t.resolve(o,"withoutCoords");else t.resolve([],"noObjects")},error:function(e){t.reject(" Failed: "+e)}})}(),t.promise()}},{key:"getPointsOfImageByMaskAsynch",value:function(e,t){var i=$.Deferred();return function(){var r={dpi:"96",transparent:"true",format:"png32",layers:"show:6,7",bbox:t.bbox3857,bboxSR:t.bboxSR,imageSR:t.imageSR,size:t.size,layerDefs:JSON.stringify({6:"ID = '"+e+"'",7:"ID = '"+e+"'"}),f:"image"};L.Util.getParamString(r),$.ajax({url:"http://pkk5.rosreestr.ru/arcgis/rest/services/Cadastre/CadastreSelected/MapServer/export?",type:"GET",data:r,success:function(e){var t=new Image;t.setAttribute("crossOrigin","anonymous"),t.onload=function(){var e,i=MSQR(t,{tolerance:1.5,path2D:!0,maxShapes:25}),a=document.createElement("canvas");a.width=t.width,a.height=t.height,e=a.getContext("2d"),e.drawImage(t,0,0),e.fillStyle="rgb(255, 255, 0)",e.beginPath();for(var o=0;o<i.length;o++)if(i[o].length>3)for(var n=0;n<i[o].length;n++)0===n?e.moveTo(i[o][n].x,i[o][n].y):(i[o].length,e.lineTo(i[o][n].x,i[o][n].y));e.rect(0,0,t.width,t.height),e.fill();for(var s=e.getImageData(0,0,t.width,t.height),l=0;l<s.data.length;l+=4)0===s.data[l+3]?(s.data[l]=255,s.data[l+1]=0,s.data[l+2]=0,s.data[l+3]=255):(s.data[l]=0,s.data[l+1]=0,s.data[l+2]=0,s.data[l+3]=0);e.putImageData(s,0,0);for(var d=MSQR(e,{tolerance:1.5,path2D:!0,maxShapes:100}),h=[],u=0;u<i.length;u++)i[u].length>2&&h.push(i[u]);for(var p=[],c=d.length-1;c>=0;c--)d[c].length>2&&p.push(d[c]);l.resolve(h,p,t.width,t.height,r.bbox)},t.src=this.url},error:function(e){i.reject(" Failed: "+e)}})}(),i.promise()}},{key:"getDataByLocationAsynch",value:function(e){var t=$.Deferred();return function(){var i=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},r={text:e,tolerance:"16",limit:11,callback:"JQuery"+i()+i()},a=[];this[r.callback]=function(e){},$.ajax({url:"https://pkk5.rosreestr.ru/api/features/1?",type:"GET",data:r,dataType:"jsonp",jsonpCallback:r.callback,crossDomain:!0,success:function(e){e.features.length>0?($.each(e.features,function(e,t){var i=L.Projection.SphericalMercator.unproject(L.point(t.center.x,t.center.y));a.push({display_name:t.attrs.address,type:"Feature",geojson:{type:"Point",coordinates:[i[Object.keys(i)[1]],i[Object.keys(i)[0]]]},properties:{address:t.attrs.address,cn:t.attrs.cn,id:t.attrs.id,extent:t.extent,sort:t.sort,type:t.type}})}),t.resolve(a)):t.resolve([])},error:function(e){t.reject(" Failed: "+e)}})}(),t.promise()}}]),e}();t.CadastrSearchPPK5=function(){function e(t,i){r(this,e),this.map=t,this.options=i,this.pkk5Provider=new o(this.map)}return a(e,[{key:"getGeoJsonByCadNum",value:function(e){var t=$.Deferred(),i=this;return this.pkk5Provider.getDataByMaskAsynch(e).then(function(e,r){var a=e;if("withCoords"===r){var o=[e[0].properties.extent.xmin,e[0].properties.extent.ymin,e[0].properties.extent.xmax,e[0].properties.extent.ymax],n=o.join(),s=new L.latLngBounds(L.Projection.SphericalMercator.unproject(new L.point(e[0].properties.extent.xmin,e[0].properties.extent.ymax)),L.Projection.SphericalMercator.unproject(new L.point(e[0].properties.extent.xmax,e[0].properties.extent.ymin))),l=i.map.getPixelBounds(s._northEast,18),d=i.map.getPixelBounds(s._southWest,18),h={x:null,y:null},u={x:null,y:null};h.x=l.min.x+i.map.getSize().x/2,h.y=l.min.y+i.map.getSize().y/2,u.x=d.min.x+i.map.getSize().x/2,u.y=d.min.y+i.map.getSize().y/2;var p,c,f=u.y-h.y,g=h.x-u.x;c=f/4096>1?f/4096:1,p=g/4096>1?g/4096:1;var m=[p,c].sort(),y=[g/m[1],f/m[1]],v=y.join();i.pkk5Provider.getPointsOfImageByMaskAsynch(e[0].properties.id,{bbox3857:n,bboxSR:"3857",imageSR:"3857",size:v}).then(function(e,r){for(var o={type:"MultiPolygon",coordinates:[]},n=0;n<e.length;n++){for(var s=[],l=[],d=0;d<e[n].length;d++){var p=L.point(e[n][d].x*m[1]+u.x,e[n][d].y*m[1]+h.y);l.push([i.map.unproject(p,18).lng,i.map.unproject(p,18).lat])}if(e[n].length>0){var c=L.point(e[n][0].x*m[1]+u.x,e[n][0].y*m[1]+h.y);l.push([i.map.unproject(c,18).lng,i.map.unproject(c,18).lat])}s.push(l),o.coordinates.push(s)}for(var f=[],g=0;g<r.length;g++){for(var y=[],v=0;v<r[g].length;v++){var b=L.point(r[g][v].x*m[1]+u.x,r[g][v].y*m[1]+h.y);y.push([i.map.unproject(b,18).lng,i.map.unproject(b,18).lat])}if(r[g].length>0){var _=L.point(r[g][0].x*m[1]+u.x,r[g][0].y*m[1]+h.y);y.push([i.map.unproject(_,18).lng,i.map.unproject(_,18).lat])}f.push(y)}if(f.length>0)for(var x=0;x<o.coordinates.length;x++)for(var M=0;M<f.length;M++){var P=TDMap.Utils.GeoUtil.intersectionByBBox(f[M],o.coordinates[x][0],i.map);P&&o.coordinates[x].push(f[M])}var w={type:"Feature"};w.geometry=o,w.properties=a[0].properties,null===w.properties.util_code&&(w.properties.util_code=999),null===w.properties.fp&&(w.properties.fp=999),null===w.properties.area_unit&&(w.properties.area_unit=999),null===w.properties.cad_unit&&(w.properties.cad_unit=999),null===w.properties.category_type&&(w.properties.category_type=999),null===w.properties.util_code&&(w.properties.util_code=999),null===w.properties.statecd&&(w.properties.statecd=999),t.resolve(w,"withCoords")},function(e){t.resolve(e,"error")})}else"withoutCoords"===r?t.resolve(a,"withoutCoords"):"noObjects"===r&&t.resolve(a,"noObjects")},function(e){t.resolve(e,"error")}),t.promise()}},{key:"getFullListOflngLats",value:function(e){var t=(this.options.step,this.options.crs,this.getBboxOfPointsArray(e)),i=[];i.push(L.Projection.Mercator.project(new L.LatLng(t[0],t[1]))),i.push(L.Projection.Mercator.project(new L.LatLng(t[2],t[3])));var r=[],a=[],o=[],n=i[0].x,s=i[0].y;do{r.push(n),n+=this.options.step}while(n<i[1].x);do{a.push(s),s+=this.options.step}while(s<i[1].y);for(var l=0;l<r.length;l++)for(var d=0;d<a.length;d++)o.push([r[l],a[d]]);return o}},{key:"getBboxOfPointsArray",value:function(e){var t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return e.reduce(function(e,t){return[Math.min(t[0],e[0]),Math.min(t[1],e[1]),Math.max(t[0],e[2]),Math.max(t[1],e[3])]},t)}},{key:"getArrayofPointsInsideGeometry",value:function(e){for(var t=this.getFullListOflngLats(e),i=[],r=0;r<t.length;r++)!0===this.checkLngLatString([L.Projection.Mercator.unproject(new L.Point(t[r][0],t[r][1])).lat,L.Projection.Mercator.unproject(new L.Point(t[r][0],t[r][1])).lng],e)&&i.push([L.Projection.Mercator.unproject(new L.Point(t[r][0],t[r][1])).lat,L.Projection.Mercator.unproject(new L.Point(t[r][0],t[r][1])).lng]);return i}},{key:"checkLngLatString",value:function(e,t){for(var i=e[0],r=e[1],a=!1,o=0,n=t.length-1;o<t.length;n=o++){var s=t[o][0],l=t[o][1],d=t[n][0],h=t[n][1];l>r!=h>r&&i<(d-s)*(r-l)/(h-l)+s&&(a=!a)}return a}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=t.SpatialFilterUtils={};r.SpatialFilterPolygon=L.Polygon.extend({options:{className:"leaflet-interactive spatial-filter-polygon"}}),r.SpatialFilterCircle=L.Circle.extend({options:{className:"leaflet-interactive spatial-filter-cirlce"}}),L.Editable.PathEditor.prototype.onVertexMarkerAddEvent=function(e){this.fireAndForward("editable:vertex:add",e)},r.SpatialFilterVertex=L.Editable.VertexMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon spatial-filter-edge"},onAdd:function(e){L.Editable.VertexMarker.prototype.onAdd.call(this,e),this.onAddEvent()},onAddEvent:function(){this.editor.onVertexMarkerAddEvent(this)}}),r.SpatialFilterMiddleVertex=L.Editable.MiddleMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon spatial-filter-middleEdge"}}),t.SpatialFilter=L.Editable.extend({options:{vertexMarkerClass:r.SpatialFilterVertex,polygonClass:r.SpatialFilterPolygon,middleMarkerClass:r.SpatialFilterMiddleVertex,circleClass:r.SpatialFilterCircle,lineGuideOptions:{className:"measurment-lineguide"}},initialize:function(e,t){L.Editable.prototype.initialize.call(this,e),L.setOptions(this,t),this.map=e,this.map.spatialFilter=this,e.on("spatialfilter:stop",function(){this.abortDrawing(),this.featuresLayer.remove()},this)},disableMapZoom:function(){this.map.doubleClickZoom.disable(),this.map.touchZoom.disable()},enableMapZoom:function(){this.map.doubleClickZoom.enable(),this.map.touchZoom.enable()},enableMapZoomWhile:function(){var e=this;setTimeout(function(){e.map.doubleClickZoom.enable(),e.map.touchZoom.enable()},10)},abortDrawing:function(){this.off("editable:drawing:end",this.enableMapZoomWhile),this.off("editable:drawing:end",this.drawingPolygonEnd),this.off("editable:vertex:dragend",this.drawingPolygonEnd),this.off("editable:drawing:end",this.drawingCircleEnd),this.off("editable:vertex:dragend",this.drawingCircleEnd),this.enableMapZoom(),this.stopDrawing(),this.featuresLayer.remove(),this.removeLabel()},startPolygonSpatialFilter:function(){this.on("editable:drawing:end",this.drawingPolygonEnd),this.on("editable:vertex:dragend",this.drawingPolygonEnd),this.on("editable:vertex:deleted",this.drawingPolygonEnd),this.on("editable:vertex:add",this.drawingPolygonEnd),this.on("editable:drawing:start",this.disableMapZoom,this),this.on("editable:drawing:end",this.enableMapZoomWhile,this),L.Editable.prototype.startPolygon.call(this)},startCircleSpatialFilter:function(){this.on("editable:drawing:start",this.disableMapZoom,this),this.on("editable:drawing:end",this.drawingCircleEnd),this.on("editable:vertex:dragend",this.drawingCircleEnd),this.on("editable:vertex:drag",this.shawRadius),this.on("editable:drawing:end",this.enableMapZoomWhile,this),this.map.on("zoomend",this.shawRadius,this),L.Editable.prototype.startCircle.call(this)},drawingPolygonEnd:function(e){if(e.editor){var t=0;if(e.editor.editLayer.eachLayer(function(e){t++}),t<6)return}e.editTools.featuresLayer.eachLayer(function(e){e.bringToBack()});var i=this.featuresLayer._layers[this.featuresLayer._leaflet_id+1];i._map.fireEvent("spatialfilter:bounds",i.toGeoJSON().geometry.coordinates)},drawingCircleEnd:function(e){e.editTools.featuresLayer.eachLayer(function(e){e.bringToBack()});var t=e.editTools.featuresLayer._layers[e.editTools.featuresLayer._leaflet_id+1];t._map.fireEvent("spatialfilter:circle",{centerPoint:t._latlng,radius:t.getRadius()})},shawRadius:function(e){var t,i,r=e.editTools||this;r.editLayer.eachLayer(function(e){var r;e.eachLayer(function(e){r=e}),t=r.latlngs[0].distanceTo(r.latlngs[1]),i=r._icon._leaflet_pos}),r.createMouseMoveLabel(t,i)},createMouseMoveLabel:function(e,t){function i(t,i){t.each(function(){for(var t=d3.select(this),r=e.split("_"),a=!0,o=[],n=0,s=t.attr("x"),l=t.attr("y"),d=t.text(null).append("tspan").attr("x",s).attr("y",l).attr("dy","0em");a;)a=r.pop(),o.push(a),d.text(o.join(" ")),d.node().getComputedTextLength()>i&&(o.pop(),d.text(o.join("/")),o=[a],d=t.append("tspan").attr("x",s).attr("y",l).attr("dy",1.1*++n+0+"em").text(a))})}if(this.removeLabel(),void 0!==e){e=e<1e3?"Радиус: "+e.toFixed(0)+" м":"Радиус: "+(e/1e3).toFixed(1)+" км";var r,a=d3.select(".leaflet-overlay-pane").select("svg").append("g").attr("class","spatial-filter"),o=a.append("rect"),n=a.append("text").attr("x",t.x+25).attr("y",t.y-15).attr("class","spatial-filter-label-text").call(i,180);if(null!==n.node()){r=n.node().getBBox();var s=r.width+6,l=r.height+2;o.attr("class","spatial-filter-label-rectangle").attr("width",s+5).attr("height",l).attr("x",r.x-5).attr("y",r.y-1).style("fill","white").style("fill-opacity",.5).style("stroke","#3f51b5").style("stroke-width","1px").style("stroke-opacity",1)}}},removeLabel:function(){var e=$(".spatial-filter");e&&e.remove()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Routing=void 0;var r=i(7),a=i(8),o=t.Routing={},n=L.Class.extend({options:{baseUrl:r.config.routingUrl},initialize:function(e){L.setOptions(this,e),this.startPoint=null,this.endPoint=null,this.middlePoints=[]},request:function(){this.checkPoints();var e=this;return TDMap.Utils.Promise.httpPromise()({type:"GET",url:e.getUrl(),params:{alternatives:!1,overview:!1,steps:!0}})},parceResult:function(e){for(var t=[],i=0;i<e.routes.length;i++){var r={distance:e.routes[i].distance,waypoints:e.waypoints};r.legs=[];for(var a=0;a<e.routes[i].legs.length;a++){var o={distance:e.routes[i].legs[a].distance,summary:e.routes[i].legs[a].summary};o.steps=[];for(var n=0;n<e.routes[i].legs[a].steps.length;n++){var s={distance:e.routes[i].legs[a].steps[n].distance,geometry:this._decode(e.routes[i].legs[a].steps[n].geometry),mode:e.routes[i].legs[a].steps[n].mode,name:e.routes[i].legs[a].steps[n].name};o.steps.push(s)}r.legs.push(o)}t.push(r)}return t},getUrl:function(){return this.options.url+this.getEndPointAsString()+";"+this.getMiddlePointsAsString()+this.getStartPointAsString()},setStartPoint:function(e){return e instanceof L.LatLng?this.startPoint=e:this.startPoint=new L.LatLng(e[0],e[1]),this},setEndPoint:function(e){return e instanceof L.LatLng?this.endPoint=e:this.endPoint=new L.LatLng(e[0],e[1]),this},setMiddlePoints:function(e){this.middlePoints.length>0&&(this.middlePoints=[]);for(var t=0;t<e.length;t++){var i=e[t];i?this.middlePoints.push(i):this.middlePoints.push(new L.LatLng(i[0],i[1]))}return this},getStartPoint:function(){return this.startPoint},getEndPoint:function(){return this.endPoint},getMiddlePoints:function(){return this.middlePoints},getStartPointAsString:function(){return(void 0).startPoint.lng+","+(void 0).startPoint.lat},getEndPointAsString:function(){return this.endPoint.lng+","+this.endPoint.lat},getMiddlePointsAsString:function(){var e="";if(this.middlePoints.length>0)for(var t=0;t<this.middlePoints.length;t++)e=e+this.middlePoints[t].lng+","+this.middlePoints[t].lat+";";return e},checkPoints:function(){return null===this.startPoint||void 0===this.startPoint?void alert("Не задана начальная точка"):null===this.endPoint||void 0===this.endPoint?void alert("Не задана конечная точка"):void 0},_decode:function(e,t){for(var i,r,a=0,o=0,n=0,s=[],l=0,d=0,h=null,u=Math.pow(10,t||5);a<e.length;){h=null,l=0,d=0;do{h=e.charCodeAt(a++)-63,d|=(31&h)<<l,l+=5}while(h>=32);i=1&d?~(d>>1):d>>1,l=d=0;do{h=e.charCodeAt(a++)-63,d|=(31&h)<<l,l+=5}while(h>=32);r=1&d?~(d>>1):d>>1,o+=i,n+=r,s.push([o/u,n/u])}return s}});o.RouterPolyline=L.Polyline.extend({options:{className:"leaflet-interactive router-polyline"}}),o.RouterSubhiddenVertex=L.Editable.VertexMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon router-hidden-edge"}}),o.RouterStartEndVertex=L.Marker.extend({options:{className:"router-start-end"}}),o.RouterWayMarker=L.Marker.extend({initialize:function(e,t){var i={draggable:!0,icon:L.divIcon({className:"router-way-marker"})};this.editTools=t,L.Marker.prototype.initialize.call(this,e,i),this.editTools.wayPoints.addLayer(this),this.on("dragend",this.onDragEnd,this),this.on("dblclick",this.removeOnClick,this)},onDragEnd:function(e){this.editTools.redrawRouteViaAndEnd(this)},removeOnClick:function(e){this.remove(),delete this.editTools.wayPoints._layers[this._leaflet_id],this.editTools.redrawRouteViaAndEnd(),L.Draggable._dragging=!1}}),o.RouterEditVertex=L.Editable.VertexMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon router-edge"},onAdd:function(e){L.Editable.VertexMarker.prototype.onAdd.call(this,e),this.map=e,this.on("mouseout",this.onMouseOut,this)},onMouseOut:function(e){this.remove()},onMouseDown:function(e){L.Editable.VertexMarker.prototype.onDragEnd.call(this,e),this.replaceEditOnViaMarker(e)},replaceEditOnViaMarker:function(e){new TDMap.Routing.RouterWayMarker(e.target._latlng,e.layer.editor.tools),e.layer.editor.refresh(),L.Draggable._dragging=!1,this.remove()}}),o.Router=L.Editable.extend({options:{vertexMarkerClass:o.RouterSubhiddenVertex,markerClass:o.RouterStartEndVertex,polylineClass:o.RouterPolyline,skipMiddleMarkers:!0},initialize:function(e,t){L.Editable.prototype.initialize.call(this,e,t),this.tools=this,this.map=e,this.routeProvider=new n,this.startPoint=null,this.endPoint=null,this.wayPoints=(new L.layerGroup).addTo(this.map),e.on("router:stop",function(){this.abortDrawing()},this)},abortDrawing:function(){for(var e in this.editLayer._layers)this.editLayer._layers[e].remove(),delete this.editLayer._layers[e];this.stopDrawing(),this.wayPoints.remove(),this.featuresLayer.remove()},startRouter:function(){this.on("editable:drawing:commit",this.endRouter),this.on("editable:dragstart",this.showMCADPoints),this.on("editable:dragend",this.redrawRouteViaAndEnd),this.on("editable:dragend",this.hideMCADPoints),L.Editable.prototype.startMarker.call(this)},endRouter:function(e){if(e.latlng,null===e.editTools.startPoint||"start"===e.layer.options.routePoint){this.startPoint=e.layer,"editable:drawing:commit"===e.type&&(e.layer.options.routePoint="start");for(var t in e.editTools.editLayer._layers)e.editTools.editLayer._layers[t].remove(),delete e.editTools.editLayer._layers[t];this.getElevenRoutesThenOne()}},bringEndPointToMcad:function(e){for(var t=this.arrayOfMCAD(),i=[],r=0;r<t.length;r++)i.push({layerLatLng:t[r],distance:e._latlng.distanceTo(t[r])});e.setLatLng(i.sort(this.comFunction).slice(0,1)[0].layerLatLng)},redrawRouteViaAndEnd:function(e){var t;if(e){var i=e.layer||e;t=e.editTools||e.editor.tools,"end"===i.options.routePoint&&t.bringEndPointToMcad(e.layer)}else t=this;if(t.endPoint){var r=[];t.wayPoints.eachLayer(function(e){r.push(e._latlng)}),t.routeProvider.setStartPoint(t.startPoint._latlng).setEndPoint(t.endPoint._latlng).setMiddlePoints(r).request().then(function(e){t.clearRoutes().drawRoute(t.routeProvider.parceResult(e.data)[0])})}},clearRoutes:function(){return this.route.remove(),delete this.route,this},drawRoute:function(e){for(var t=this,i=[],r=0;r<e.legs.length;r++)for(var a=0;a<e.legs[r].steps.length;a++)i=i.concat(e.legs[r].steps[a].geometry);for(var o=i.length-2;o>=0;o--)i[o][0]===i[o+1][0]&&i[o][1]===i[o+1][1]&&i.splice(o,1);if(this.route=this.createPolyline(i,{polylineClass:this.options.polylineClass,waypoints:e.waypoints}).addTo(this.featuresLayer),this.route.on("mouseover mousemove",t.routeMouseOver),!this.endPoint){var n=this.createMarker(i[0],{markerClass:this.options.markerClass,routePoint:"end"});this.featuresLayer.addLayer(n),this.endPoint=n}return this.route.on("click",this.clickWayMarker),this.featuresLayer.eachLayer(function(e){e.editor||e.toggleEdit()}),this.fireEvent("router:ready",{route:e}),this},clickWayMarker:function(e){new TDMap.Routing.RouterWayMarker(e.latlng,e.target.editor.tools),e.target.editor.refresh()},routeMouseOver:function(e){e.target.editor.tools.clearAllViaMarkers().createViaMarker(e)},clearAllViaMarkers:function(){var e=this;return this.editMarker&&this.editMarker.remove(),this.editLayer.eachLayer(function(t){t instanceof TDMap.Routing.RouterEditVertex&&(t.remove(),delete e.editLayer._layers[t._leaflet_id])}),this},createViaMarker:function(e){var t=e.target,i=this._closestPolylineData(e.layerPoint,t);this.editMarker=new TDMap.Routing.RouterEditVertex(this.map.layerPointToLatLng(i.point),t.getLatLngs(),t.editor),this.editLayer.addLayer(this.editMarker)},_closestPolylineData:function(e,t,i){for(var r=t.getLatLngs(),a=t._rings[0],o=[],n=a.length-2;n>=0;n--){var s=a[n],l=a[n+1],d=L.LineUtil.pointToSegmentDistance(e,s,l);o.push({distance:d,from:s,to:l,fl:r[n],tl:r[n+1],i:n})}var h=o.sort(this.comFunction),u=h[0];return{point:L.LineUtil.closestPointOnSegment(e,u.from,u.to),features:u}},getElevenRoutesThenOne:function(){for(var e=this,t=this.getElevenPoints(),i=[],r=[],a=0;a<t.length;a++){var o=new n;o.setStartPoint(this.startPoint._latlng).setEndPoint(t[a].layerLatLng).setMiddlePoints(this.wayPoints),r.push(o.request())}angular.injector(["ng"]).get("$q").all(r).then(function(t){for(var r=0;r<t.length;r++)i.push(e.routeProvider.parceResult(t[r].data));var a=i.sort(e.comFunction2);e.drawRoute(a[0][0])})},getElevenPoints:function(){for(var e=this.arrayOfMCAD(),t=[],i=0;i<e.length;i++)t.push({layerLatLng:e[i],distance:this.startPoint._latlng.distanceTo(e[i])});return t.sort(this.comFunction).slice(0,11)},comFunction:function(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0},comFunction2:function(e,t){return e[0].distance<t[0].distance?-1:e[0].distance>t[0].distance?1:0},showMCADPoints:function(e){if("start"!==e.layer.options.routePoint){var t=this.arrayOfMCAD();this.mcadPoints=(new L.LayerGroup).addTo(this.map);for(var i=0;i<t.length;i++)this.mcadPoints.addLayer(new L.circleMarker(t[i],{color:"#E53935",weight:2,fillColor:"#E53935",fillOpacity:.4}))}},hideMCADPoints:function(){this.mcadPoints&&(this.mcadPoints.remove(),delete this.mcadPoints)},arrayOfMCAD:function(){for(var e=[],t=0;t<a.McadPoints.length;t++)e.push(new L.latLng(a.McadPoints[t][1],a.McadPoints[t][0]));return e}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.config={routingUrl:"http://188.134.5.249:3030/route/v1/driving/"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.McadPoints=[[37.370743963,55.7900346394],[37.378270044,55.7960801265],[37.3858805489,55.8090674539],[37.389455252,55.813351974],[37.3903679421,55.8159160498],[37.3919461355,55.8212680135],[37.3953893225,55.8333960946],[37.394925847,55.8319678193],[37.3956507702,55.8356785564],[37.392347022,55.8497441067],[37.3974159383,55.8591232043],[37.399958636,55.8625941994],[37.4031815731,55.8656151612],[37.4191322597,55.8738805922],[37.4258562192,55.8760086759],[37.4316175758,55.8778166554],[37.4439531536,55.8815563457],[37.4512047621,55.8827081777],[37.4862720291,55.8882668866],[37.4868139389,55.8884188401],[37.490236527,55.8895784658],[37.4949211944,55.8916017297],[37.4996557746,55.8936968563],[37.5481067871,55.9084475027],[37.5427946452,55.9078799665],[37.5708028243,55.910857441],[37.5818763228,55.9109853275],[37.5877874176,55.9101860305],[37.5935701654,55.908703291],[37.6295144706,55.8997257115],[37.6664142483,55.8956172896],[37.6715481304,55.8954200531],[37.682538441,55.8951108695],[37.6992520794,55.8940873477],[37.7073902333,55.8917043562],[37.7131420827,55.8891239499],[37.7249975475,55.8830294581],[37.730901512,55.8801391721],[37.8278463193,55.8302772253],[37.8301660734,55.8289422831],[37.8391218456,55.814708952],[37.8394926259,55.8111511412],[37.8396067122,55.8101895149],[37.8429437356,55.7779506079],[37.8433050088,55.7748493065],[37.8436282532,55.7707316803],[37.8434286022,55.7670200964],[37.8428771853,55.7553107823],[37.8423542899,55.7460542456],[37.8419930167,55.740777572],[37.8405205908,55.7291252899],[37.8390659908,55.7170578494],[37.8378966066,55.712804242],[37.836848439,55.7107997849],[37.8314293412,55.7005991606],[37.8314970799,55.6854640667],[37.8323455965,55.683124557],[37.8395686834,55.6574611634],[37.8387486884,55.6553452535],[37.8348982768,55.6505136313],[37.8273828438,55.6453112266],[37.8204948853,55.6408043314],[37.8180919433,55.6392267955],[37.7986117128,55.6264190387],[37.798233802,55.6261291856],[37.7809614181,55.6167931363],[37.7470088691,55.5989104603],[37.7396645655,55.5958352148],[37.7323202619,55.5927731589],[37.7219336578,55.588387825],[37.7191765729,55.5872863778],[37.703382755,55.5814025142],[37.6896686348,55.5762500511],[37.6838335975,55.5741539404],[37.6500117722,55.5726892838],[37.6382585097,55.5733745886],[37.6352780059,55.5735761466],[37.6193059282,55.574511362],[37.6028775054,55.575462679],[37.6003390859,55.575615855],[37.5903850589,55.576671947],[37.5739281146,55.5805735977],[37.5698923128,55.5815167072],[37.5298765539,55.5911157886],[37.5259976207,55.5920264108],[37.4967972401,55.6066901578],[37.4937525628,55.6093362997],[37.4890179826,55.6134038409],[37.4711563511,55.6283977433],[37.4677480238,55.6313805399],[37.4600614614,55.6377881553],[37.4568100027,55.640673655],[37.4524580869,55.6446769169],[37.4289135331,55.666142281],[37.4255979009,55.6706382181],[37.4170271699,55.6820607217],[37.4153016151,55.6853328693],[37.4109805977,55.6925354533],[37.400178054,55.7007653533],[37.3953079964,55.7043493189],[37.3908015888,55.7076959317],[37.3830651137,55.7185373097],[37.3796710471,55.7252358495],[37.3747653376,55.7346873495],[37.3729470877,55.7384889855],[37.3689089091,55.7629799824],[37.3690515169,55.7672802708],[37.369179864,55.7696949637],[37.3693224718,55.7733768817],[37.3756970421,55.7931762657]]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.geoJSONServiceLayer=exports.GeoJSONServiceLayer=exports.GeoJSONProvider=void 0;var _TDMapUtilsPromises=__webpack_require__(0),GeoJSONProvider=exports.GeoJSONProvider={initialize:function(e){if(void 0===e.dataUrl&&null===e.dataUrl)throw new Error("Не задан url для GeoJSONProvider");this.options=e},getData:function(){return _TDMapUtilsPromises.Promises.getPromise(this.options.dataUrl,this.options.params,this.options.headers)},getDataByBounds:function(e){return this.options.params||(this.options.params={}),e instanceof L.LatLngBounds?this.options.params.bbox=this._getMinMaxBounds(e):this.options.params.bbox=e,this.options.styled?this.options.params.styled=this.options.styled:delete this.options.params.styled,this.options.labeled?this.options.params.labeled=this.options.labeled:delete this.options.params.labeled,_TDMapUtilsPromises.Promises.getPromise(this.options.dataUrl,this.options.params,this.options.headers)},_getMinMaxBounds:function(e){if(e){var t=e.getNorthWest(),i=e.getSouthEast();return[t.lng,i.lat,i.lng,t.lat].toString()}}},GeoJSONServiceLayer=exports.GeoJSONServiceLayer=L.GeoJSON.extend({includes:GeoJSONProvider,initialize:function(e){this.filteredIds=[],this.filterMode=!1,L.GeoJSON.prototype.initialize.call(this,null,e),GeoJSONProvider.initialize.call(this,e),L.setOptions(this,e)},setStyles:function(e){this.styles=e},removeStyles:function(){this.options.styled=!1,this.styles=!1},setLabels:function(e){this.labels=e},removeLabels:function(){this.options.labeled=!1,this.labels=!1},onAdd:function(e){this.map=e,L.GeoJSON.prototype.onAdd.call(this,e),e.on("moveend",this._updateData,this),this._updateData()},onRemove:function(e){this.clearLayers(),L.GeoJSON.prototype.onRemove.call(this,e),e.off("moveend",this._updateData,this)},_updateData:function(e){var t;t=this.options.bounds?this.options.bounds:this.options.circle?this.options.circle:this.map.getBounds();var i=this.map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)return void this.clearLayers();this._updateDataByBounds(t,i)},_updateDataByBounds:function(e,t){var i=this;this.getDataByBounds(e).then(function(e){var t;e.data.geoJSON?t=e.data.geoJSON[0]||e.data.geoJSON:e.data.inbounds?t=e.data.inbounds[0]:e.data.features&&(t=e.data),i._replaceData(t.features)},function(e){i.clearLayers()})},styleEnebledInZoom:function(e){for(var t=this.map.getZoom(),i=this.styles.length-1;i>=0;i--)for(var r=this.styles[i].styles.length-1;r>=0;r--){if(this.styles[i].styles[r].id===e.id&&t>=this.styles[i].minZoom&&t<=this.styles[i].maxZoom)return!0;if(this.styles[i].otherStyle.id===e.id&&!0===this.styles[i].otherStyle.allow&&t>=this.styles[i].minZoom&&t<=this.styles[i].maxZoom)return!0}return!1},_replaceData:function(e){var t=this;if(null!==e&&void 0!==e){this.clearLayers();for(var i=0;i<e.length;i++)if(null!==e[i])if(this.styles){if(e[i].styles&&e[i].styles.length>0)for(var r=0;r<e[i].styles.length;r++)if(null!==e[i].styles[r]&&this.styleEnebledInZoom(e[i].styles[r])){e[i].style=e[i].styles[r];var a={};for(var o in e[i])a[o]=e[i][o];this.addData(a)}}else this.addData(e[i]);this.eachLayer(function(e){e&&t._subscribe(e),e.feature.style&&e.setStyle(e.feature.style)}),this.map.fire("layer:load"),this.filterMode&&this.stayOrRemoveViaFilteredIds(),this.updateLabels()}else this.clearLayers()},updateLabels:function(){if(this.clearLabels(),this.labels&&this.labels.length>0){var e=this.map.getZoom();e>=this.labels[0].minZoom&&e<=this.labels[0].maxZoom&&this.labelFeatures(this.labels[0])}},labelFeatures:function labelFeatures(label){function Point(e,t){this.x=e,this.y=t}function Region(e){this.points=e||[],this.length=e.length}function isNumber(e){return/^[0-9]{1,7}([,.][0-9]{1,7})?$/.test(e)}var that=this;Region.prototype.area=function(){var e,t,i,r,a=0;for(e=0,t=this.length-1;e<this.length;t=e,e++)i=this.points[e],r=this.points[t],a+=i.x*r.y,a-=i.y*r.x;return a/=2},Region.prototype.centroid=function(){var e,t,i,r,a,o=0,n=0;for(e=0,t=this.length-1;e<this.length;t=e,e++)r=this.points[e],a=this.points[t],i=r.x*a.y-a.x*r.y,o+=(r.x+a.x)*i,n+=(r.y+a.y)*i;return i=6*this.area(),new Point(o/i,n/i)},that.eachLayer(function(layer){if(layer._path&&"hidden"!==layer._path.style.visibility){var textEval=function textEval(){if("boolean"===label.workField.options.type&&"Да"!==layer.feature.properties.labelvalue&&"Нет"!==layer.feature.properties.labelvalue&&(null===layer.feature.properties.labelvalue||!1===layer.feature.properties.labelvalue?layer.feature.properties.labelvalue="Нет":layer.feature.properties.labelvalue="Да"),!label.designed)return layer.feature.properties.labelvalue;var str;str=isNumber(layer.feature.properties.labelvalue)?label.designedString.replace("{значение}",layer.feature.properties.labelvalue):label.designedString.replace("{значение}","'"+layer.feature.properties.labelvalue+"'"),label.rounded&&label.roundedNumber&&(str="("+str+").toFixed("+label.roundedNumber+")");try{return eval(str)}catch(e){throw that.fire("ERROR",{message:"Ошибка формирования строки подписи. Проверьте составную подпись"}),new Error}};layer._path.id="layer"+layer._leaflet_id;var group=d3.select(".leaflet-overlay-pane").select("svg").append("g").attr("class","labels"),region;layer._parts&&layer._parts[0]&&layer._parts[0].length>0&&(region=new Region(layer._parts[0])),d3.selectAll("#layer"+layer._leaflet_id).each(function(e,t){if(region){var i=(this.getBBox(),{x:region.centroid().x,y:region.centroid().y});0===i.x&&0===i.y||isNaN(i.x)||isNaN(i.y)||i.x!==Number.POSITIVE_INFINITY&&i.x!==Number.NEGATIVE_INFINITY&&i.y!==Number.POSITIVE_INFINITY&&i.y!==Number.NEGATIVE_INFINITY&&(group.append("text").attr("class","oreol").style("stroke",label.oreolColor).style("opacity",label.oreolOpacity).style("stroke-width",label.oreolWidth).style("font-size",label.fontSize).style("text-anchor","middle").style("font-family","Roboto,Helvetica Neue,sans-serif").attr("x",i.x).attr("y",i.y).text(textEval),group.append("text").attr("class","textpath").style("fill",label.textColor).style("fill-opacity",label.textOpacity).style("text-anchor","middle").style("font-size",label.fontSize).style("font-family","Roboto,Helvetica Neue,sans-serif").attr("x",i.x).attr("y",i.y).text(textEval))}})}})},clearLabels:function(){$(".labels").remove()},_subscribe:function(e){e&&(this.layer=e,e.on("click",this._clickFireAndForward,this))},_unSubcribeLayer:function(e){e.off("click",this._clickFireAndForward)},_clickFireAndForward:function(e){this.fire("tdmap:layer:click",e.target)},stayOrRemoveViaFilteredIds:function(){var e=this;this.eachLayer(function(t){-1===e.filteredIds.indexOf(t.feature.properties.zu_id)?t._path.style.visibility="hidden":"hidden"===t._path.style.visibility&&(t._path.style.visibility="visible")})},setFilteredIds:function(e){return this.filteredIds=e,this.filterMode=!0,this.stayOrRemoveViaFilteredIds(),this},removeFilteredIds:function(){return this.filteredIds=null,this.filterMode=!1,this._updateData(),this}}),geoJSONServiceLayer=exports.geoJSONServiceLayer=function(e){return new GeoJSONServiceLayer(e)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),L.GridLayer.GoogleMutant=L.GridLayer.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,type:"roadmap",maxNativeZoom:21},initialize:function(e){L.GridLayer.prototype.initialize.call(this,e),this._ready=!!window.google&&!!window.google.maps&&!!window.google.maps.Map,this._GAPIPromise=this._ready?Promise.resolve(window.google):new Promise(function(e,t){var i=0,r=null;r=setInterval(function(){return i>=10?(clearInterval(r),t(new Error("window.google not found after 10 attempts"))):window.google&&window.google.maps&&window.google.maps.Map?(clearInterval(r),e(window.google)):void i++},500)}),this._tileCallbacks={},this._freshTiles={},this._imagesPerTile="hybrid"===this.options.type?2:1,this.createTile="hybrid"===this.options.type?this._createMultiTile:this._createSingleTile},onAdd:function(e){L.GridLayer.prototype.onAdd.call(this,e),this._initMutantContainer(),this._GAPIPromise.then(function(){this._ready=!0,this._map=e,this._initMutant(),e.on("viewreset",this._reset,this),e.on("move",this._update,this),e.on("zoomend",this._handleZoomAnim,this),e.on("resize",this._resize,this),e._controlCorners.bottomright.style.marginBottom="20px",this._reset(),this._update()}.bind(this))},onRemove:function(e){L.GridLayer.prototype.onRemove.call(this,e),e._container.removeChild(this._mutantContainer),this._mutantContainer=void 0,e.off("viewreset",this._reset,this),e.off("move",this._update,this),e.off("zoomend",this._handleZoomAnim,this),e.off("resize",this._resize,this),e._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(e){this.options.opacity=e,e<1&&L.DomUtil.setOpacity(this._mutantContainer,e)},setElementSize:function(e,t){e.style.width=t.x+"px",e.style.height=t.y+"px"},_initMutantContainer:function(){this._mutantContainer||(this._mutantContainer=L.DomUtil.create("div","leaflet-google-mutant leaflet-top leaflet-left"),this._mutantContainer.id="_MutantContainer_"+L.Util.stamp(this._mutantContainer),this._mutantContainer.style.position="relative",this._mutantContainer.style.pointerEvents="none",this._map.getContainer().appendChild(this._mutantContainer)),this.setOpacity(this.options.opacity),this.setElementSize(this._mutantContainer,this._map.getSize()),this._attachObserver(this._mutantContainer)},_initMutant:function(){if(this._ready&&this._mutantContainer){this._mutantCenter=new google.maps.LatLng(0,0);var e=new google.maps.Map(this._mutantContainer,{center:this._mutantCenter,zoom:0,tilt:0,mapTypeId:this.options.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.styles||{},backgroundColor:"transparent"});this._mutant=e,this.fire("spawned",{mapObject:e})}},_attachObserver:function(e){new MutationObserver(this._onMutations.bind(this)).observe(e,{childList:!0,subtree:!0})},_onMutations:function(e){for(var t=0;t<e.length;++t)for(var i=e[t],r=0;r<i.addedNodes.length;++r){var a=i.addedNodes[r];a instanceof HTMLImageElement?this._onMutatedImage(a):a instanceof HTMLElement&&Array.prototype.forEach.call(a.querySelectorAll("img"),this._onMutatedImage.bind(this))}},_roadRegexp:/!1i(\d+)!2i(\d+)!3i(\d+)!/,_satRegexp:/x=(\d+)&y=(\d+)&z=(\d+)/,_staticRegExp:/StaticMapService\.GetMapImage/,_onMutatedImage:function(e){var t,i,r,a=e.src.match(this._roadRegexp);if(a?(t={z:a[1],x:a[2],y:a[3]},this._imagesPerTile>1&&(e.style.zIndex=0),i=1):(a=e.src.match(this._satRegexp),a&&(t={x:a[1],y:a[2],z:a[3]}),i=0),t){var o=this._tileCoordsToKey(t);e.style.position="absolute",this._imagesPerTile>1&&(o+="/"+i),o in this._tileCallbacks&&this._tileCallbacks[o]?(this._tileCallbacks[o].pop()(e),this._tileCallbacks[o].length||delete this._tileCallbacks[o]):(r=e.parentNode,r&&(r.removeChild(e),r.removeChild=L.Util.falseFn),o in this._freshTiles?this._freshTiles[o].push(e):this._freshTiles[o]=[e])}else e.src.match(this._staticRegExp)&&(r=e.parentNode)&&e.parentNode.replaceChild(L.DomUtil.create("img"),e)},_createSingleTile:function(e,t){var i=this._tileCoordsToKey(e);if(i in this._freshTiles){var r=this._freshTiles[i].pop();return this._freshTiles[i].length||delete this._freshTiles[i],L.Util.requestAnimFrame(t),r}var a=L.DomUtil.create("div");return this._tileCallbacks[i]=this._tileCallbacks[i]||[],this._tileCallbacks[i].push(function(e){return function(i){var r=i.parentNode;r&&(r.removeChild(i),r.removeChild=L.Util.falseFn),e.appendChild(i),t()}.bind(this)}.bind(this)(a)),a},_createMultiTile:function(e,t){var i=this._tileCoordsToKey(e),r=L.DomUtil.create("div");r.dataset.pending=this._imagesPerTile;for(var a=0;a<this._imagesPerTile;a++){var o=i+"/"+a;o in this._freshTiles?(r.appendChild(this._freshTiles[o].pop()),this._freshTiles[o].length||delete this._freshTiles[o],r.dataset.pending--):(this._tileCallbacks[o]=this._tileCallbacks[o]||[],this._tileCallbacks[o].push(function(e){return function(i){var r=i.parentNode;r&&(r.removeChild(i),r.removeChild=L.Util.falseFn),e.appendChild(i),e.dataset.pending--,parseInt(e.dataset.pending)||t()}.bind(this)}.bind(this)(r)))}return parseInt(r.dataset.pending)||L.Util.requestAnimFrame(t),r},_checkZoomLevels:function(){void 0!==this._map.getZoom()&&this._mutant.getZoom()!==this._map.getZoom()&&this._map.setZoom(this._mutant.getZoom())},_reset:function(){this._initContainer()},_update:function(){if(L.GridLayer.prototype._update.call(this),this._mutant){var e=this._map.getCenter(),t=new google.maps.LatLng(e.lat,e.lng);this._mutant.setCenter(t),void 0!==this._map.getZoom()&&this._mutant.setZoom(Math.round(this._map.getZoom()))}},_resize:function(){var e=this._map.getSize();this._mutantContainer.style.width===e.x&&this._mutantContainer.style.height===e.y||(this.setElementSize(this._mutantContainer,e),this._mutant&&google.maps.event.trigger(this._mutant,"resize"))},_handleZoomAnim:function(){var e=this._map.getCenter(),t=new google.maps.LatLng(e.lat,e.lng);this._mutant.setCenter(t),this._mutant.setZoom(Math.round(this._map.getZoom()))},_removeTile:function(e){if(this._imagesPerTile>1)for(var t=0;t<this._imagesPerTile;t++){var i=e+"/"+t;i in this._freshTiles&&delete this._freshTiles[i]}else e in this._freshTiles&&delete this._freshTiles[e];return L.GridLayer.prototype._removeTile.call(this,e)}}),L.gridLayer.googleMutant=function(e){return new L.GridLayer.GoogleMutant(e)},t.GoogleMutant=L.GridLayer.GoogleMutant,t.googleMutant=L.gridLayer.googleMutant},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YandexProvider=L.Layer.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,attribution:"",opacity:1,traffic:!1},possibleShortMapTypes:{schemaMap:"map",satelliteMap:"satellite",hybridMap:"hybrid",publicMap:"publicMap",publicMapInHybridView:"publicMapHybrid"},_getPossibleMapType:function(e){var t="yandex#map";if("string"!=typeof e)return t;for(var i in this.possibleShortMapTypes){if(e===this.possibleShortMapTypes[i]){t="yandex#"+e;break}e==="yandex#"+this.possibleShortMapTypes[i]&&(t=e)}return t},initialize:function(e,t){L.Util.setOptions(this,t),this._type=this._getPossibleMapType(e)},onAdd:function(e,t){this._map=e,this._insertAtTheBottom=t,this._initContainer(),this._initMapObject(),e.on("viewreset",this._reset,this),this._limitedUpdate=L.Util.throttle(this._update,1,this),e.on("move",this._update,this),e._controlCorners.bottomright.style.marginBottom="3em",this._reset(),this._update(!0)},onRemove:function(e){this._map._container.removeChild(this._container),this._map.off("viewreset",this._reset,this),this._map.off("move",this._update,this),e._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(e){this.options.opacity=e,e<1&&L.DomUtil.setOpacity(this._container,e)},setElementSize:function(e,t){e.style.width=t.x+"px",e.style.height=t.y+"px"},_initContainer:function(){var e=this._map._container,t=e.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-yandex-layer leaflet-top leaflet-left"),this._container.id="_YMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),this.options.overlay&&(t=this._map._container.getElementsByClassName("leaflet-map-pane")[0],t=t.nextSibling,L.Browser.opera&&(this._container.className+=" leaflet-objects-pane")),e.insertBefore(this._container,t),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(!this._yandex){if(void 0===ymaps.Map)return ymaps.load(["package.map"],this._initMapObject,this);if(this.options.traffic&&(void 0===ymaps.control||void 0===ymaps.control.TrafficControl))return ymaps.load(["package.traffic","package.controls"],this._initMapObject,this);var e=new ymaps.Map(this._container,{center:[0,0],zoom:0,behaviors:[],controls:[]});this.options.traffic&&e.controls.add(new ymaps.control.TrafficControl({shown:!0})),"yandex#null"===this._type&&(this._type=new ymaps.MapType("null",[]),e.container.getElement().style.background="transparent"),e.setType(this._type),this._yandex=e,this._update(!0),this.fire("MapObjectInitialized",{mapObject:e})}},_reset:function(){this._initContainer()},_update:function(e){if(this._yandex){this._resize(e);var t=this._map.getCenter(),i=[t.lat,t.lng];this._yandex.setCenter(i),void 0!==this._map.getZoom()&&this._yandex.setZoom(Math.round(this._map.getZoom()))}},_resize:function(e){var t=this._map.getSize(),i=this._container.style;i.width===t.x+"px"&&i.height===t.y+"px"&&!0!==e||(this.setElementSize(this._container,t),this._yandex.container.fitToViewport())}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e.extend({onAdd:function(e){L.TileLayer.prototype.onAdd.call(this,e),this.options.clickable&&(L.DomUtil.addClass(this._container,"leaflet-clickable-raster-layer"),this._needInitInteraction&&(this._initInteraction(),this._needInitInteraction=!1))},_needInitInteraction:!0,_initInteraction:function(){for(var e=this._container,t=["dblclick","click","mousedown","mouseover","mouseout","contextmenu"],i=0;i<t.length;i++)L.DomEvent.on(e,t[i],this._fireMouseEvent,this)},_fireMouseEvent:function(e){var t=this._map;if(!t.dragging||!t.dragging.moved()){var i=t.mouseEventToContainerPoint(e),r=t.containerPointToLayerPoint(i),a=t.layerPointToLatLng(r);this.fire(e.type,{latlng:a,layerPoint:r,containerPoint:i,originalEvent:e})}}})};L.TileLayer.Rosreestr=function(e){return e.extend({options:{tileSize:256},getTileUrl:function(e){var t=this._map,i=t.options.crs,r=this.options.tileSize,a=e.multiplyBy(r),o=a.add([r,r]),n=i.project(t.unproject(a,e.z)),s=i.project(t.unproject(o,e.z)),l=[n.x,s.y,s.x,n.y].join(",");return L.Util.template(this._url,L.extend({s:this._getSubdomain(e),bbox:l},this.options))}})}(L.TileLayer),L.tileLayer.Rosreestr=function(e,t){return t.clickable&&(L.TileLayer.Rosreestr=r(L.TileLayer.Rosreestr)),new L.TileLayer.Rosreestr(e,t)},t.RosreestrProvider=L.TileLayer.Rosreestr}]);