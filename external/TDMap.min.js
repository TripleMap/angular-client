!function(t){function e(r){if(i[r])return i[r].exports;var o=i[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=11)}([function(t,e,i){"use strict";(function(t){var i="undefined"!=typeof window&&window,r="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,o=void 0!==t&&t,n=i||o||r;e.root=n,function(){if(!n)throw new Error("RxJS could not find any global context (window, self, global)")}()}).call(e,i(22))},function(t,e,i){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},n=i(7),s=i(2),a=i(9),l=i(3),u=function(t){function e(i,o,n){switch(t.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=a.empty;break;case 1:if(!i){this.destination=a.empty;break}if("object"===(void 0===i?"undefined":r(i))){i instanceof e?(this.syncErrorThrowable=i.syncErrorThrowable,this.destination=i,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new c(this,i));break}default:this.syncErrorThrowable=!0,this.destination=new c(this,i,o,n)}}return o(e,t),e.prototype[l.rxSubscriber]=function(){return this},e.create=function(t,i,r){var o=new e(t,i,r);return o.syncErrorThrowable=!1,o},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this,e=t._parent,i=t._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=i,this},e}(s.Subscription);e.Subscriber=u;var c=function(t){function e(e,i,r,o){t.call(this),this._parentSubscriber=e;var s,l=this;n.isFunction(i)?s=i:i&&(s=i.next,r=i.error,o=i.complete,i!==a.empty&&(l=Object.create(i),n.isFunction(l.unsubscribe)&&this.add(l.unsubscribe.bind(l)),l.unsubscribe=this.unsubscribe.bind(this))),this._context=l,this._next=s,this._error=r,this._complete=o}return o(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber;if(this._error)e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else{if(!e.syncErrorThrowable)throw this.unsubscribe(),t;e.syncErrorValue=t,e.syncErrorThrown=!0,this.unsubscribe()}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var i=function(){return t._complete.call(t._context)};e.syncErrorThrowable?(this.__tryOrSetError(e,i),this.unsubscribe()):(this.__tryOrUnsub(i),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){throw this.unsubscribe(),t}},e.prototype.__tryOrSetError=function(t,e,i){try{e.call(this._context,i)}catch(e){return t.syncErrorValue=e,t.syncErrorThrown=!0,!0}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(u)},function(t,e,i){"use strict";function r(t){return t.reduce(function(t,e){return t.concat(e instanceof c.UnsubscriptionError?e.errors:e)},[])}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=i(24),s=i(25),a=i(7),l=i(26),u=i(8),c=i(27),h=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var i=this,o=i._parent,h=i._parents,d=i._unsubscribe,p=i._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var f=-1,y=h?h.length:0;o;)o.remove(this),o=++f<y&&h[f]||null;if(a.isFunction(d)){var m=l.tryCatch(d).call(this);m===u.errorObject&&(e=!0,t=t||(u.errorObject.e instanceof c.UnsubscriptionError?r(u.errorObject.e.errors):[u.errorObject.e]))}if(n.isArray(p))for(f=-1,y=p.length;++f<y;){var b=p[f];if(s.isObject(b)){var m=l.tryCatch(b.unsubscribe).call(b);if(m===u.errorObject){e=!0,t=t||[];var g=u.errorObject.e;g instanceof c.UnsubscriptionError?t=t.concat(r(g.errors)):t.push(g)}}}if(e)throw new c.UnsubscriptionError(t)}},t.prototype.add=function(e){if(!e||e===t.EMPTY)return t.EMPTY;if(e===this)return this;var i=e;switch(void 0===e?"undefined":o(e)){case"function":i=new t(e);case"object":if(i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if("function"!=typeof i._addParent){var r=i;i=new t,i._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(i),i._addParent(this),i},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var i=e.indexOf(t);-1!==i&&e.splice(i,1)}},t.prototype._addParent=function(t){var e=this,i=e._parent,r=e._parents;i&&i!==t?r?-1===r.indexOf(t)&&r.push(t):this._parents=[t]:this._parent=t},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();e.Subscription=h},function(t,e,i){"use strict";var r=i(0),o=r.root.Symbol;e.rxSubscriber="function"==typeof o&&"function"==typeof o.for?o.for("rxSubscriber"):"@@rxSubscriber",e.$$rxSubscriber=e.rxSubscriber},function(t,e,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();e.Promises=function(){function t(){r(this,t)}return o(t,[{key:"getPromise",value:function(t,e){var i={url:t,type:"GET"};return e&&(i.params=e),$.get(i)}}]),t}()},function(t,e,i){"use strict";var r=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(6),n=i(1),s=i(2),a=i(10),l=i(31),u=i(3),c=function(t){function e(e){t.call(this,e),this.destination=e}return r(e,t),e}(n.Subscriber);e.SubjectSubscriber=c;var h=function(t){function e(){t.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return r(e,t),e.prototype[u.rxSubscriber]=function(){return new c(this)},e.prototype.lift=function(t){var e=new d(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new a.ObjectUnsubscribedError;if(!this.isStopped)for(var e=this.observers,i=e.length,r=e.slice(),o=0;o<i;o++)r[o].next(t)},e.prototype.error=function(t){if(this.closed)throw new a.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,i=e.length,r=e.slice(),o=0;o<i;o++)r[o].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new a.ObjectUnsubscribedError;this.isStopped=!0;for(var t=this.observers,e=t.length,i=t.slice(),r=0;r<e;r++)i[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new a.ObjectUnsubscribedError;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new a.ObjectUnsubscribedError;return this.hasError?(t.error(this.thrownError),s.Subscription.EMPTY):this.isStopped?(t.complete(),s.Subscription.EMPTY):(this.observers.push(t),new l.SubjectSubscription(this,t))},e.prototype.asObservable=function(){var t=new o.Observable;return t.source=this,t},e.create=function(t,e){return new d(t,e)},e}(o.Observable);e.Subject=h;var d=function(t){function e(e,i){t.call(this),this.destination=e,this.source=i}return r(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):s.Subscription.EMPTY},e}(h);e.AnonymousSubject=d},function(t,e,i){"use strict";var r=i(0),o=i(23),n=i(28),s=i(29),a=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var i=new t;return i.source=this,i.operator=e,i},t.prototype.subscribe=function(t,e,i){var r=this.operator,n=o.toSubscriber(t,e,i);if(r?r.call(n,this.source):n.add(this.source||!n.syncErrorThrowable?this._subscribe(n):this._trySubscribe(n)),n.syncErrorThrowable&&(n.syncErrorThrowable=!1,n.syncErrorThrown))throw n.syncErrorValue;return n},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.syncErrorThrown=!0,t.syncErrorValue=e,t.error(e)}},t.prototype.forEach=function(t,e){var i=this;if(e||(r.root.Rx&&r.root.Rx.config&&r.root.Rx.config.Promise?e=r.root.Rx.config.Promise:r.root.Promise&&(e=r.root.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,r){var o;o=i.subscribe(function(e){if(o)try{t(e)}catch(t){r(t),o.unsubscribe()}else t(e)},r,e)})},t.prototype._subscribe=function(t){return this.source.subscribe(t)},t.prototype[n.observable]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return 0===t.length?this:s.pipeFromArray(t)(this)},t.prototype.toPromise=function(t){var e=this;if(t||(r.root.Rx&&r.root.Rx.config&&r.root.Rx.config.Promise?t=r.root.Rx.config.Promise:r.root.Promise&&(t=r.root.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,i){var r;e.subscribe(function(t){return r=t},function(t){return i(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}();e.Observable=a},function(t,e,i){"use strict";function r(t){return"function"==typeof t}e.isFunction=r},function(t,e,i){"use strict";e.errorObject={e:{}}},function(t,e,i){"use strict";e.empty={closed:!0,next:function(t){},error:function(t){throw t},complete:function(){}}},function(t,e,i){"use strict";var r=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=function(t){function e(){var e=t.call(this,"object unsubscribed");this.name=e.name="ObjectUnsubscribedError",this.stack=e.stack,this.message=e.message}return r(e,t),e}(Error);e.ObjectUnsubscribedError=o},function(t,e,i){"use strict";function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.TDMapManager=e.TDMap=void 0;var s=i(12),a=i(4),l=i(13),u=i(14),c=i(15),h=i(16),d=i(19),p=i(36),f=i(37),y=i(38),m=i(39),b=function t(){n(this,t),this.Service={GeoJSONService:d.GeoJSONService},this.Layers={GoogleProvider:p.GoogleProvider,YandexProvider:f.YandexProvider,RosreestrProvider:y.RosreestrProvider},this.Tools={MeasurmentUtils:u.MeasurmentUtils,Measurment:u.Measurment,SpatialFilterUtils:c.SpatialFilterUtils,SpatialFilter:c.SpatialFilter},this.Utils={GeoUtil:s.GeoUtil,Promises:a.Promises,CadastrSearchProviderPPK5:l.CadastrSearchProviderPPK5,CadastrSearchPPK5:l.CadastrSearchPPK5},this.Routing=h.Routing},g=(e.TDMap=new b,function(t){function e(t){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),e}(m.Manager));e.TDMapManager=g},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GeoUtil=L.Util.extend({intersectionByBBox:function(t,e,i){this.map=i;var r=this.parseResult(this.isMultiPointInsideBBox(t,e));return"within"===r||"overlaps"===r},isMultiPointInsideBBox:function(t,e){for(var i=[],r=0;r<t.length;r++)i.push(this.pointIntersectionMath(t[r],e));return i},pointIntersectionMath:function(t,e){for(var i=t[0],r=t[1],o=!1,n=0,s=e.length-1;n<e.length;s=n++){var a=e[n][0],l=e[n][1],u=e[s][0],c=e[s][1];l>r!=c>r&&i<(u-a)*(r-l)/(c-l)+a&&(o=!o)}return o},parseResult:function(t){return!0===t&&"boolean"==typeof t?"within":!1===t&&"boolean"==typeof t?"no intersects":t.constructor===Array?(t.sort(),t[0]===t[t.length-1]&&!0===t[0]?"within":t[0]===t[t.length-1]&&!1===t[0]?"no intersects":"overlaps"):void 0}})},function(t,e,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=e.CadastrSearchProviderPPK5=function(){function t(e){r(this,t),this.map=e}return o(t,[{key:"getDataByMask",value:function(t){}},{key:"getDataByMaskAsynch",value:function(t){var e=$.Deferred();return function(){function i(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var r={text:t,tolerance:"16391",limit:16,callback:"JQuery"+i()+i()},o=[],n=[];this[r.callback]=function(t){};var s=Number(t.split(":")[0]).toString()+":"+Number(t.split(":")[1]).toString()+":"+Number(t.split(":")[2]).toString()+":"+Number(t.split(":")[3]).toString();$.ajax({url:"https://pkk5.rosreestr.ru/api/features/1/"+s,type:"GET",dataType:"jsonp",success:function(t){if(void 0!==t.feature&&null!==t.feature)if(t.feature.center&&t.feature.extent){var i=L.Projection.SphericalMercator.unproject(L.point(t.feature.center.x,t.feature.center.y)),r={type:"Feature",geojson:{type:"Point",coordinates:[i[Object.keys(i)[1]],i[Object.keys(i)[0]]]}};r.properties=t.feature.attrs,r.properties.extent=t.feature.extent,r.properties.center=t.feature.center,o.push(r),e.resolve(o,"withCoords")}else n.push({type:"Feature",properties:{cn:t.feature.attrs.cn,id:t.feature.attrs.id}}),e.resolve(n,"withoutCoords");else e.resolve([],"noObjects")},error:function(t){e.reject(" Failed: "+t)}})}(),e.promise()}},{key:"getPointsOfImageByMaskAsynch",value:function(t,e){var i=$.Deferred();return function(){var r={dpi:"96",transparent:"true",format:"png32",layers:"show:6,7",bbox:e.bbox3857,bboxSR:e.bboxSR,imageSR:e.imageSR,size:e.size,layerDefs:JSON.stringify({6:"ID = '"+t+"'",7:"ID = '"+t+"'"}),f:"image"};L.Util.getParamString(r),$.ajax({url:"http://pkk5.rosreestr.ru/arcgis/rest/services/Cadastre/CadastreSelected/MapServer/export?",type:"GET",data:r,success:function(t){var e=new Image;e.setAttribute("crossOrigin","anonymous"),e.onload=function(){var t,i=MSQR(e,{tolerance:1.5,path2D:!0,maxShapes:25}),o=document.createElement("canvas");o.width=e.width,o.height=e.height,t=o.getContext("2d"),t.drawImage(e,0,0),t.fillStyle="rgb(255, 255, 0)",t.beginPath();for(var n=0;n<i.length;n++)if(i[n].length>3)for(var s=0;s<i[n].length;s++)0===s?t.moveTo(i[n][s].x,i[n][s].y):(i[n].length,t.lineTo(i[n][s].x,i[n][s].y));t.rect(0,0,e.width,e.height),t.fill();for(var a=t.getImageData(0,0,e.width,e.height),l=0;l<a.data.length;l+=4)0===a.data[l+3]?(a.data[l]=255,a.data[l+1]=0,a.data[l+2]=0,a.data[l+3]=255):(a.data[l]=0,a.data[l+1]=0,a.data[l+2]=0,a.data[l+3]=0);t.putImageData(a,0,0);for(var u=MSQR(t,{tolerance:1.5,path2D:!0,maxShapes:100}),c=[],h=0;h<i.length;h++)i[h].length>2&&c.push(i[h]);for(var d=[],p=u.length-1;p>=0;p--)u[p].length>2&&d.push(u[p]);l.resolve(c,d,e.width,e.height,r.bbox)},e.src=this.url},error:function(t){i.reject(" Failed: "+t)}})}(),i.promise()}},{key:"getDataByLocationAsynch",value:function(t){var e=$.Deferred();return function(){var i=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},r={text:t,tolerance:"16",limit:11,callback:"JQuery"+i()+i()},o=[];this[r.callback]=function(t){},$.ajax({url:"https://pkk5.rosreestr.ru/api/features/1?",type:"GET",data:r,dataType:"jsonp",jsonpCallback:r.callback,crossDomain:!0,success:function(t){t.features.length>0?($.each(t.features,function(t,e){var i=L.Projection.SphericalMercator.unproject(L.point(e.center.x,e.center.y));o.push({display_name:e.attrs.address,type:"Feature",geojson:{type:"Point",coordinates:[i[Object.keys(i)[1]],i[Object.keys(i)[0]]]},properties:{address:e.attrs.address,cn:e.attrs.cn,id:e.attrs.id,extent:e.extent,sort:e.sort,type:e.type}})}),e.resolve(o)):e.resolve([])},error:function(t){e.reject(" Failed: "+t)}})}(),e.promise()}}]),t}();e.CadastrSearchPPK5=function(){function t(e,i){r(this,t),this.map=e,this.options=i,this.pkk5Provider=new n(this.map)}return o(t,[{key:"getGeoJsonByCadNum",value:function(t){var e=$.Deferred(),i=this;return this.pkk5Provider.getDataByMaskAsynch(t).then(function(t,r){var o=t;if("withCoords"===r){var n=[t[0].properties.extent.xmin,t[0].properties.extent.ymin,t[0].properties.extent.xmax,t[0].properties.extent.ymax],s=n.join(),a=new L.latLngBounds(L.Projection.SphericalMercator.unproject(new L.point(t[0].properties.extent.xmin,t[0].properties.extent.ymax)),L.Projection.SphericalMercator.unproject(new L.point(t[0].properties.extent.xmax,t[0].properties.extent.ymin))),l=i.map.getPixelBounds(a._northEast,18),u=i.map.getPixelBounds(a._southWest,18),c={x:null,y:null},h={x:null,y:null};c.x=l.min.x+i.map.getSize().x/2,c.y=l.min.y+i.map.getSize().y/2,h.x=u.min.x+i.map.getSize().x/2,h.y=u.min.y+i.map.getSize().y/2;var d,p,f=h.y-c.y,y=c.x-h.x;p=f/4096>1?f/4096:1,d=y/4096>1?y/4096:1;var m=[d,p].sort(),b=[y/m[1],f/m[1]],g=b.join();i.pkk5Provider.getPointsOfImageByMaskAsynch(t[0].properties.id,{bbox3857:s,bboxSR:"3857",imageSR:"3857",size:g}).then(function(t,r){for(var n={type:"MultiPolygon",coordinates:[]},s=0;s<t.length;s++){for(var a=[],l=[],u=0;u<t[s].length;u++){var d=L.point(t[s][u].x*m[1]+h.x,t[s][u].y*m[1]+c.y);l.push([i.map.unproject(d,18).lng,i.map.unproject(d,18).lat])}if(t[s].length>0){var p=L.point(t[s][0].x*m[1]+h.x,t[s][0].y*m[1]+c.y);l.push([i.map.unproject(p,18).lng,i.map.unproject(p,18).lat])}a.push(l),n.coordinates.push(a)}for(var f=[],y=0;y<r.length;y++){for(var b=[],g=0;g<r[y].length;g++){var v=L.point(r[y][g].x*m[1]+h.x,r[y][g].y*m[1]+c.y);b.push([i.map.unproject(v,18).lng,i.map.unproject(v,18).lat])}if(r[y].length>0){var _=L.point(r[y][0].x*m[1]+h.x,r[y][0].y*m[1]+c.y);b.push([i.map.unproject(_,18).lng,i.map.unproject(_,18).lat])}f.push(b)}if(f.length>0)for(var w=0;w<n.coordinates.length;w++)for(var x=0;x<f.length;x++){var S=TDMap.Utils.GeoUtil.intersectionByBBox(f[x],n.coordinates[w][0],i.map);S&&n.coordinates[w].push(f[x])}var P={type:"Feature"};P.geometry=n,P.properties=o[0].properties,null===P.properties.util_code&&(P.properties.util_code=999),null===P.properties.fp&&(P.properties.fp=999),null===P.properties.area_unit&&(P.properties.area_unit=999),null===P.properties.cad_unit&&(P.properties.cad_unit=999),null===P.properties.category_type&&(P.properties.category_type=999),null===P.properties.util_code&&(P.properties.util_code=999),null===P.properties.statecd&&(P.properties.statecd=999),e.resolve(P,"withCoords")},function(t){e.resolve(t,"error")})}else"withoutCoords"===r?e.resolve(o,"withoutCoords"):"noObjects"===r&&e.resolve(o,"noObjects")},function(t){e.resolve(t,"error")}),e.promise()}},{key:"getFullListOflngLats",value:function(t){var e=(this.options.step,this.options.crs,this.getBboxOfPointsArray(t)),i=[];i.push(L.Projection.Mercator.project(new L.LatLng(e[0],e[1]))),i.push(L.Projection.Mercator.project(new L.LatLng(e[2],e[3])));var r=[],o=[],n=[],s=i[0].x,a=i[0].y;do{r.push(s),s+=this.options.step}while(s<i[1].x);do{o.push(a),a+=this.options.step}while(a<i[1].y);for(var l=0;l<r.length;l++)for(var u=0;u<o.length;u++)n.push([r[l],o[u]]);return n}},{key:"getBboxOfPointsArray",value:function(t){var e=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return t.reduce(function(t,e){return[Math.min(e[0],t[0]),Math.min(e[1],t[1]),Math.max(e[0],t[2]),Math.max(e[1],t[3])]},e)}},{key:"getArrayofPointsInsideGeometry",value:function(t){for(var e=this.getFullListOflngLats(t),i=[],r=0;r<e.length;r++)!0===this.checkLngLatString([L.Projection.Mercator.unproject(new L.Point(e[r][0],e[r][1])).lat,L.Projection.Mercator.unproject(new L.Point(e[r][0],e[r][1])).lng],t)&&i.push([L.Projection.Mercator.unproject(new L.Point(e[r][0],e[r][1])).lat,L.Projection.Mercator.unproject(new L.Point(e[r][0],e[r][1])).lng]);return i}},{key:"checkLngLatString",value:function(t,e){for(var i=t[0],r=t[1],o=!1,n=0,s=e.length-1;n<e.length;s=n++){var a=e[n][0],l=e[n][1],u=e[s][0],c=e[s][1];l>r!=c>r&&i<(u-a)*(r-l)/(c-l)+a&&(o=!o)}return o}}]),t}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=e.MeasurmentUtils={};r.MeasureLine=L.Polyline.extend({options:{className:"leaflet-interactive measurment-line"}}),r.MeasurePolygon=L.Polygon.extend({options:{className:"leaflet-interactive measurment-polygon"}}),r.MeasureVertex=L.Editable.VertexMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon measurment-edge"},onAdd:function(t){L.Editable.VertexMarker.prototype.onAdd.call(this,t),this.on("mouseover",this.mouseover),this.on("mouseout",this.mouseout)},mouseover:function(t){this.editor.fireAndForward("editable:vertex:mouseover",t)},mouseout:function(t){this.editor.fireAndForward("editable:vertex:mouseout",t)}}),r.MeasureMiddleVertex=L.Editable.MiddleMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon measurment-middleEdge"},onAdd:function(t){L.Editable.MiddleMarker.prototype.onAdd.call(this,t),this.on("mouseover",this.mouseover),this.on("mouseout",this.mouseout)},mouseover:function(t){t.left=this.left,t.right=this.right,this.editor.fireAndForward("editable:middlemarker:mouseover",t)},mouseout:function(t){t.middleMarkerId=this._leaflet_id,this.editor.fireAndForward("editable:middlemarker:mouseout",t)}}),e.Measurment=L.Editable.extend({options:{vertexMarkerClass:r.MeasureVertex,polylineClass:r.MeasureLine,polygonClass:r.MeasurePolygon,middleMarkerClass:r.MeasureMiddleVertex,lineGuideOptions:{className:"measurment-lineguide"}},initialize:function(t,e){L.Editable.prototype.initialize.call(this,t),L.setOptions(this,e),t.measureTools=this,this.map=t;var i=this;t.on("stopmeasure",function(){var t;i.abortDrawing();for(var e in i.featuresLayer._layers)t=i.featuresLayer._layers[e]._leaflet_id;i.removeLabel(t),i.featuresLayer.remove(),i.map.off("zoomend",i.dravingZoomEnd)},this)},disableMapZoom:function(){this.map.doubleClickZoom&&this.map.doubleClickZoom.disable(),this.map.touchZoom&&this.map.touchZoom.disable()},enableMapZoom:function(){this.map.doubleClickZoom||this.map.doubleClickZoom.enable(),this.map.touchZoom||this.map.touchZoom.enable()},abortDrawing:function(){this.off("editable:vertex:mouseover editable:vertex:mouseout editable:middlemarker:mouseover editable:middlemarker:mouseout editable:vertex:drag editable:vertex:dragend editable:drawing:move",this.preMeasureCookLayer),this.off("editable:vertex:drag editable:vertex:dragend editable:drawing:move editable:vertex:mouseover editable:vertex:mouseout editable:middlemarker:mouseout",this.preMeasureCookLayer),this.off("editable:drawing:end",this.dravingLineEnd),this.off("editable:drawing:end",this.dravingPolygonEnd),this.enableMapZoom(),this.stopDrawing()},startPolylineMeasure:function(){this.disableMapZoom(),this.on("editable:vertex:mouseover editable:vertex:mouseout editable:middlemarker:mouseover editable:middlemarker:mouseout editable:vertex:drag editable:vertex:dragend editable:drawing:move",this.preMeasureCookLayer),this.on("editable:drawing:end",this.dravingLineEnd),L.Editable.prototype.startPolyline.call(this)},dravingLineEnd:function(t){this.off("editable:drawing:move",this.preMeasureCookLayer),this.preMeasureCookLayer(t),this.enableMapZoom(),this.map.on("zoomend",this.dravingZoomEnd)},startPolygonMeasure:function(){this.disableMapZoom(),this.on("editable:vertex:drag editable:vertex:dragend editable:drawing:move editable:vertex:mouseover editable:vertex:mouseout editable:middlemarker:mouseout",this.preMeasureCookLayer),this.on("editable:drawing:end",this.dravingPolygonEnd),L.Editable.prototype.startPolygon.call(this)},dravingPolygonEnd:function(t){var e=this;e.off("editable:drawing:move",e.preMeasureCookLayer),e.preMeasureCookLayer(t),e.enableMapZoom(),e.map.on("zoomend",this.dravingZoomEnd),e.on("editable:middlemarker:mouseover",e.preMeasureCookLineLayer)},dravingZoomEnd:function(t){for(var e in t.target.measureTools.featuresLayer._layers)t.layer=t.target.measureTools.featuresLayer._layers[e],t.layer.toGeoJSON().geometry.type,t.target.measureTools.preMeasureCookLayer(t)},preMeasureCookLayer:function(t){"Polygon"===(t.layer||t.target).toGeoJSON().geometry.type?t.target.measureTools?t.target.measureTools.preMeasureCookPolygonLayer(t):t.editTools.preMeasureCookPolygonLayer(t):t.target.measureTools?t.target.measureTools.preMeasureCookLineLayer(t):t.editTools.preMeasureCookLineLayer(t)},preMeasureCookLineLayer:function(t){for(var e,i=t.layer,r=this._getLineLatLngs(i),o=[],n=[],s=0;s<r.length;s++)o.push(r[s]);if(this.removeLabel(i._leaflet_id),"editable:drawing:move"===t.type){var a=t.latlng;e=t.layerPoint,o.push(a)}else if("editable:drawing:end"===t.type||"editable:vertex:dragend"===t.type||"editable:vertex:mouseout"===t.type||"editable:middlemarker:mouseout"===t.type)e=i._rings[0][i._rings[0].length-1];else if("editable:vertex:drag"===t.type)e=t.vertex.dragging._draggable._newPos;else if("editable:vertex:mouseover"===t.type){e=t.layerPoint;for(var l,u=0;u<i._rings[0].length;u++)i._rings[0][u].x===e.x&&i._rings[0][u].y===e.y&&(l=u);n=[];for(var c=0;c<r.length;c++)c-1<l&&n.push(r[c]);o=n}else"editable:middlemarker:mouseover"===t.type&&(e=t.layerPoint,n=[],n.push(t.left.latlng),n.push(t.right.latlng),o=n);if(!(o.length<1)){var h=this;"zoomend"===t.type?setTimeout(function(){h.createMouseMoveLabel({pathLength:h._getPerimeter(o)},i._rings[0][i._rings[0].length-1],i._leaflet_id)},50):this.createMouseMoveLabel({pathLength:h._getPerimeter(o)},e,i._leaflet_id)}},preMeasureCookPolygonLayer:function(t){for(var e,i=this,r=t.layer||t.target,o=this._getLineLatLngs(r),n=[],s=!1,a=0;a<o[0].length;a++)n.push(o[0][a]);if("editable:drawing:move"===t.type){var l=t.latlng;e=t.layerPoint||t.vertex.dragging._draggable._newPos,n.push(l),void 0!==o[0][o.length-1]&&n.push(o[0][o.length-1])}else"editable:drawing:end"===t.type?(e=i.map.latLngToContainerPoint(r.getCenter()),n.push(o[0][o.length-1]),s=!0):"editable:vertex:drag"===t.type?(e=t.vertex.dragging._draggable._newPos,n.push(o[0][o.length-1])):"editable:vertex:mouseover"===t.type&&(e=t.layerPoint,n.push(o[0][o.length-1]));n.length<2||("zoomend"===t.type||"editable:vertex:mouseout"===t.type||"editable:middlemarker:mouseout"===t.type||"editable:vertex:dragend"===t.type?(this.removeLabel(r._leaflet_id),setTimeout(function(){var t=$(".leaflet-map-pane").css("transform").replace("(",",").replace(")","").split(",");e=i.map.latLngToContainerPoint(r.getCenter()),e.x=e.x-t[t.length-2],e.y=e.y-t[t.length-1],n.push(o[0][o.length-1]),i.removeLabel(r._leaflet_id),s=!0,i.createMouseMoveLabel({pathLength:i._getPerimeter(n),pathSquare:i.getArea(n),screenCordsShift:s},e,r._leaflet_id)},50)):(this.removeLabel(r._leaflet_id),this.createMouseMoveLabel({pathLength:i._getPerimeter(n),pathSquare:i.getArea(n),screenCordsShift:s},e,r._leaflet_id)))},_getLineLatLngs:function(t){return t.editor.getLatLngs()},getDistance:function(t){return t.latlng1.distanceTo(t.latlng2)},_getPerimeter:function(t){for(var e=0,i=0,r=1;r<t.length;r++){var o=t[r-1],n=t[r];i=this.getDistance({latlng1:o,latlng2:n}),e+=Number(i)}return this.readableDistance(e)},getArea:function(t){var e=parseFloat(this.geodesicArea(t));return this.readableArea(e)},geodesicArea:function(t){var e,i,r=t.length,o=0,n=.017453292519943295;if(r>2){for(var s=0;s<r;s++)e=t[s],i=t[(s+1)%r],o+=(i.lng-e.lng)*n*(2+Math.sin(e.lat*n)+Math.sin(i.lat*n));o=6378137*o*6378137/2}return Math.abs(o)},readableDistance:function(t){return t>1e4?L.Util.template("{distance} км",{distance:(t/1e3).toFixed(3)}):L.Util.template("{distance} м",{distance:(t/1).toFixed(1)})},readableArea:function(t){function e(t){var e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),e.join(".")}var i=L.Util.template("{area} м²",{area:t.toFixed(0)});i=e(i);var r=t/1e4,o=L.Util.template("{gaArea} Га",{gaArea:r.toFixed(2)});return o=e(o),i+" / "+o},createMouseMoveLabel:function(t,e,i){function r(t,e){t.each(function(){for(var t=d3.select(this),i=o.split("_"),r=!0,n=[],s=0,a=t.attr("x"),l=t.attr("y"),u=t.text(null).append("tspan").attr("x",a).attr("y",l).attr("dy","0em");r;)r=i.pop(),n.push(r),u.text(n.join(" ")),u.node().getComputedTextLength()>e&&(n.pop(),u.text(n.join("/")),n=[r],u=t.append("tspan").attr("x",a).attr("y",l).attr("dy",1.1*++s+0+"em").text(r))})}var o,n=0,s=0;if(t.pathLength&&(o="Расстояние: "+t.pathLength),t.pathSquare&&(o="Периметр: "+t.pathLength,o=o+"_Площадь: "+t.pathSquare),t.screenCordsShift&&(n=-75,s=15),void 0!==o){var a,l=d3.select(".leaflet-overlay-pane").select("svg").append("g").attr("class","measurment"+i),u=l.append("rect"),c=l.append("text").attr("x",e.x+25+n).attr("y",e.y-15+s).attr("class","measurment-label-text").call(r,180);if(null!==c.node()){a=c.node().getBBox();var h=a.width+6,d=a.height+2;u.attr("class","leaflet-measure-label-rectangle").attr("width",h+5).attr("height",d).attr("x",a.x-5).attr("y",a.y-1).style("fill","white").style("fill-opacity",.5).style("stroke","#3f51b5").style("stroke-width","1px").style("stroke-opacity",1)}}},removeLabel:function(t){$(".measurment"+t).remove()},checkAndClearAllLabels:function(){$("[class^='measurment']").remove()}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=e.SpatialFilterUtils={};r.SpatialFilterPolygon=L.Polygon.extend({options:{className:"leaflet-interactive spatial-filter-polygon"}}),r.SpatialFilterCircle=L.Circle.extend({options:{className:"leaflet-interactive spatial-filter-cirlce"}}),L.Editable.PathEditor.prototype.onVertexMarkerAddEvent=function(t){this.fireAndForward("editable:vertex:add",t)},r.SpatialFilterVertex=L.Editable.VertexMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon spatial-filter-edge"},onAdd:function(t){L.Editable.VertexMarker.prototype.onAdd.call(this,t),this.onAddEvent()},onAddEvent:function(){this.editor.onVertexMarkerAddEvent(this)}}),r.SpatialFilterMiddleVertex=L.Editable.MiddleMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon spatial-filter-middleEdge"}}),e.SpatialFilter=L.Editable.extend({options:{vertexMarkerClass:r.SpatialFilterVertex,polygonClass:r.SpatialFilterPolygon,middleMarkerClass:r.SpatialFilterMiddleVertex,circleClass:r.SpatialFilterCircle,lineGuideOptions:{className:"measurment-lineguide"}},initialize:function(t,e){L.Editable.prototype.initialize.call(this,t),L.setOptions(this,e),this.map=t,this.map.spatialFilter=this,t.on("spatialfilter:stop",function(){this.abortDrawing(),this.featuresLayer.remove()},this)},disableMapZoom:function(){this.map.doubleClickZoom.disable(),this.map.touchZoom.disable()},enableMapZoom:function(){this.map.doubleClickZoom.enable(),this.map.touchZoom.enable()},enableMapZoomWhile:function(){var t=this;setTimeout(function(){t.map.doubleClickZoom.enable(),t.map.touchZoom.enable()},10)},abortDrawing:function(){this.off("editable:drawing:end",this.enableMapZoomWhile),this.off("editable:drawing:end",this.drawingPolygonEnd),this.off("editable:vertex:dragend",this.drawingPolygonEnd),this.off("editable:drawing:end",this.drawingCircleEnd),this.off("editable:vertex:dragend",this.drawingCircleEnd),this.enableMapZoom(),this.stopDrawing(),this.featuresLayer.remove(),this.removeLabel()},startPolygonSpatialFilter:function(){this.on("editable:drawing:end",this.drawingPolygonEnd),this.on("editable:vertex:dragend",this.drawingPolygonEnd),this.on("editable:vertex:deleted",this.drawingPolygonEnd),this.on("editable:vertex:add",this.drawingPolygonEnd),this.on("editable:drawing:start",this.disableMapZoom,this),this.on("editable:drawing:end",this.enableMapZoomWhile,this),L.Editable.prototype.startPolygon.call(this)},startCircleSpatialFilter:function(){this.on("editable:drawing:start",this.disableMapZoom,this),this.on("editable:drawing:end",this.drawingCircleEnd),this.on("editable:vertex:dragend",this.drawingCircleEnd),this.on("editable:vertex:drag",this.shawRadius),this.on("editable:drawing:end",this.enableMapZoomWhile,this),this.map.on("zoomend",this.shawRadius,this),L.Editable.prototype.startCircle.call(this)},drawingPolygonEnd:function(t){if(t.editor){var e=0;if(t.editor.editLayer.eachLayer(function(t){e++}),e<6)return}t.editTools.featuresLayer.eachLayer(function(t){t.bringToBack()});var i=this.featuresLayer._layers[this.featuresLayer._leaflet_id+1];i._map.fireEvent("spatialfilter:bounds",i.toGeoJSON().geometry.coordinates)},drawingCircleEnd:function(t){t.editTools.featuresLayer.eachLayer(function(t){t.bringToBack()});var e=t.editTools.featuresLayer._layers[t.editTools.featuresLayer._leaflet_id+1];e._map.fireEvent("spatialfilter:circle",{centerPoint:e._latlng,radius:e.getRadius()})},shawRadius:function(t){var e,i,r=t.editTools||this;r.editLayer.eachLayer(function(t){var r;t.eachLayer(function(t){r=t}),e=r.latlngs[0].distanceTo(r.latlngs[1]),i=r._icon._leaflet_pos}),r.createMouseMoveLabel(e,i)},createMouseMoveLabel:function(t,e){function i(e,i){e.each(function(){for(var e=d3.select(this),r=t.split("_"),o=!0,n=[],s=0,a=e.attr("x"),l=e.attr("y"),u=e.text(null).append("tspan").attr("x",a).attr("y",l).attr("dy","0em");o;)o=r.pop(),n.push(o),u.text(n.join(" ")),u.node().getComputedTextLength()>i&&(n.pop(),u.text(n.join("/")),n=[o],u=e.append("tspan").attr("x",a).attr("y",l).attr("dy",1.1*++s+0+"em").text(o))})}if(this.removeLabel(),t){t=t<1e3?"Радиус: "+t.toFixed(0)+" м":"Радиус: "+(t/1e3).toFixed(1)+" км";var r,o=d3.select(".leaflet-overlay-pane").select("svg").append("g").attr("class","spatial-filter"),n=o.append("rect"),s=o.append("text").attr("x",e.x+25).attr("y",e.y-15).attr("class","spatial-filter-label-text").call(i,180);if(null!==s.node()){r=s.node().getBBox();var a=r.width+6,l=r.height+2;n.attr("class","spatial-filter-label-rectangle").attr("width",a+5).attr("height",l).attr("x",r.x-5).attr("y",r.y-1).style("fill","white").style("fill-opacity",.5).style("stroke","#3f51b5").style("stroke-width","1px").style("stroke-opacity",1)}}},removeLabel:function(){var t=$(".spatial-filter");t&&t.remove()}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Routing=void 0;var r=i(17),o=i(18),n=e.Routing={},s=L.Class.extend({options:{baseUrl:r.config.routingUrl},initialize:function(t){L.setOptions(this,t),this.startPoint=null,this.endPoint=null,this.middlePoints=[]},request:function(){this.checkPoints();var t=this;return TDMap.Utils.Promise.httpPromise()({type:"GET",url:t.getUrl(),params:{alternatives:!1,overview:!1,steps:!0}})},parceResult:function(t){for(var e=[],i=0;i<t.routes.length;i++){var r={distance:t.routes[i].distance,waypoints:t.waypoints};r.legs=[];for(var o=0;o<t.routes[i].legs.length;o++){var n={distance:t.routes[i].legs[o].distance,summary:t.routes[i].legs[o].summary};n.steps=[];for(var s=0;s<t.routes[i].legs[o].steps.length;s++){var a={distance:t.routes[i].legs[o].steps[s].distance,geometry:this._decode(t.routes[i].legs[o].steps[s].geometry),mode:t.routes[i].legs[o].steps[s].mode,name:t.routes[i].legs[o].steps[s].name};n.steps.push(a)}r.legs.push(n)}e.push(r)}return e},getUrl:function(){return this.options.url+this.getEndPointAsString()+";"+this.getMiddlePointsAsString()+this.getStartPointAsString()},setStartPoint:function(t){return t instanceof L.LatLng?this.startPoint=t:this.startPoint=new L.LatLng(t[0],t[1]),this},setEndPoint:function(t){return t instanceof L.LatLng?this.endPoint=t:this.endPoint=new L.LatLng(t[0],t[1]),this},setMiddlePoints:function(t){this.middlePoints.length>0&&(this.middlePoints=[]);for(var e=0;e<t.length;e++){var i=t[e];i?this.middlePoints.push(i):this.middlePoints.push(new L.LatLng(i[0],i[1]))}return this},getStartPoint:function(){return this.startPoint},getEndPoint:function(){return this.endPoint},getMiddlePoints:function(){return this.middlePoints},getStartPointAsString:function(){return(void 0).startPoint.lng+","+(void 0).startPoint.lat},getEndPointAsString:function(){return this.endPoint.lng+","+this.endPoint.lat},getMiddlePointsAsString:function(){var t="";if(this.middlePoints.length>0)for(var e=0;e<this.middlePoints.length;e++)t=t+this.middlePoints[e].lng+","+this.middlePoints[e].lat+";";return t},checkPoints:function(){return null===this.startPoint||void 0===this.startPoint?void alert("Не задана начальная точка"):null===this.endPoint||void 0===this.endPoint?void alert("Не задана конечная точка"):void 0},_decode:function(t,e){for(var i,r,o=0,n=0,s=0,a=[],l=0,u=0,c=null,h=Math.pow(10,e||5);o<t.length;){c=null,l=0,u=0;do{c=t.charCodeAt(o++)-63,u|=(31&c)<<l,l+=5}while(c>=32);i=1&u?~(u>>1):u>>1,l=u=0;do{c=t.charCodeAt(o++)-63,u|=(31&c)<<l,l+=5}while(c>=32);r=1&u?~(u>>1):u>>1,n+=i,s+=r,a.push([n/h,s/h])}return a}});n.RouterPolyline=L.Polyline.extend({options:{className:"leaflet-interactive router-polyline"}}),n.RouterSubhiddenVertex=L.Editable.VertexMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon router-hidden-edge"}}),n.RouterStartEndVertex=L.Marker.extend({options:{className:"router-start-end"}}),n.RouterWayMarker=L.Marker.extend({initialize:function(t,e){var i={draggable:!0,icon:L.divIcon({className:"router-way-marker"})};this.editTools=e,L.Marker.prototype.initialize.call(this,t,i),this.editTools.wayPoints.addLayer(this),this.on("dragend",this.onDragEnd,this),this.on("dblclick",this.removeOnClick,this)},onDragEnd:function(t){this.editTools.redrawRouteViaAndEnd(this)},removeOnClick:function(t){this.remove(),delete this.editTools.wayPoints._layers[this._leaflet_id],this.editTools.redrawRouteViaAndEnd(),L.Draggable._dragging=!1}}),n.RouterEditVertex=L.Editable.VertexMarker.extend({options:{className:"leaflet-div-icon leaflet-editing-icon router-edge"},onAdd:function(t){L.Editable.VertexMarker.prototype.onAdd.call(this,t),this.map=t,this.on("mouseout",this.onMouseOut,this)},onMouseOut:function(t){this.remove()},onMouseDown:function(t){L.Editable.VertexMarker.prototype.onDragEnd.call(this,t),this.replaceEditOnViaMarker(t)},replaceEditOnViaMarker:function(t){new TDMap.Routing.RouterWayMarker(t.target._latlng,t.layer.editor.tools),t.layer.editor.refresh(),L.Draggable._dragging=!1,this.remove()}}),n.Router=L.Editable.extend({options:{vertexMarkerClass:n.RouterSubhiddenVertex,markerClass:n.RouterStartEndVertex,polylineClass:n.RouterPolyline,skipMiddleMarkers:!0},initialize:function(t,e){L.Editable.prototype.initialize.call(this,t,e),this.tools=this,this.map=t,this.routeProvider=new s,this.startPoint=null,this.endPoint=null,this.wayPoints=(new L.layerGroup).addTo(this.map),t.on("router:stop",function(){this.abortDrawing()},this)},abortDrawing:function(){for(var t in this.editLayer._layers)this.editLayer._layers[t].remove(),delete this.editLayer._layers[t];this.stopDrawing(),this.wayPoints.remove(),this.featuresLayer.remove()},startRouter:function(){this.on("editable:drawing:commit",this.endRouter),this.on("editable:dragstart",this.showMCADPoints),this.on("editable:dragend",this.redrawRouteViaAndEnd),this.on("editable:dragend",this.hideMCADPoints),L.Editable.prototype.startMarker.call(this)},endRouter:function(t){if(t.latlng,null===t.editTools.startPoint||"start"===t.layer.options.routePoint){this.startPoint=t.layer,"editable:drawing:commit"===t.type&&(t.layer.options.routePoint="start");for(var e in t.editTools.editLayer._layers)t.editTools.editLayer._layers[e].remove(),delete t.editTools.editLayer._layers[e];this.getElevenRoutesThenOne()}},bringEndPointToMcad:function(t){for(var e=this.arrayOfMCAD(),i=[],r=0;r<e.length;r++)i.push({layerLatLng:e[r],distance:t._latlng.distanceTo(e[r])});t.setLatLng(i.sort(this.comFunction).slice(0,1)[0].layerLatLng)},redrawRouteViaAndEnd:function(t){var e;if(t){var i=t.layer||t;e=t.editTools||t.editor.tools,"end"===i.options.routePoint&&e.bringEndPointToMcad(t.layer)}else e=this;if(e.endPoint){var r=[];e.wayPoints.eachLayer(function(t){r.push(t._latlng)}),e.routeProvider.setStartPoint(e.startPoint._latlng).setEndPoint(e.endPoint._latlng).setMiddlePoints(r).request().then(function(t){e.clearRoutes().drawRoute(e.routeProvider.parceResult(t.data)[0])})}},clearRoutes:function(){return this.route.remove(),delete this.route,this},drawRoute:function(t){for(var e=this,i=[],r=0;r<t.legs.length;r++)for(var o=0;o<t.legs[r].steps.length;o++)i=i.concat(t.legs[r].steps[o].geometry);for(var n=i.length-2;n>=0;n--)i[n][0]===i[n+1][0]&&i[n][1]===i[n+1][1]&&i.splice(n,1);if(this.route=this.createPolyline(i,{polylineClass:this.options.polylineClass,waypoints:t.waypoints}).addTo(this.featuresLayer),this.route.on("mouseover mousemove",e.routeMouseOver),!this.endPoint){var s=this.createMarker(i[0],{markerClass:this.options.markerClass,routePoint:"end"});this.featuresLayer.addLayer(s),this.endPoint=s}return this.route.on("click",this.clickWayMarker),this.featuresLayer.eachLayer(function(t){t.editor||t.toggleEdit()}),this.fireEvent("router:ready",{route:t}),this},clickWayMarker:function(t){new TDMap.Routing.RouterWayMarker(t.latlng,t.target.editor.tools),t.target.editor.refresh()},routeMouseOver:function(t){t.target.editor.tools.clearAllViaMarkers().createViaMarker(t)},clearAllViaMarkers:function(){var t=this;return this.editMarker&&this.editMarker.remove(),this.editLayer.eachLayer(function(e){e instanceof TDMap.Routing.RouterEditVertex&&(e.remove(),delete t.editLayer._layers[e._leaflet_id])}),this},createViaMarker:function(t){var e=t.target,i=this._closestPolylineData(t.layerPoint,e);this.editMarker=new TDMap.Routing.RouterEditVertex(this.map.layerPointToLatLng(i.point),e.getLatLngs(),e.editor),this.editLayer.addLayer(this.editMarker)},_closestPolylineData:function(t,e,i){for(var r=e.getLatLngs(),o=e._rings[0],n=[],s=o.length-2;s>=0;s--){var a=o[s],l=o[s+1],u=L.LineUtil.pointToSegmentDistance(t,a,l);n.push({distance:u,from:a,to:l,fl:r[s],tl:r[s+1],i:s})}var c=n.sort(this.comFunction),h=c[0];return{point:L.LineUtil.closestPointOnSegment(t,h.from,h.to),features:h}},getElevenRoutesThenOne:function(){for(var t=this,e=this.getElevenPoints(),i=[],r=[],o=0;o<e.length;o++){var n=new s;n.setStartPoint(this.startPoint._latlng).setEndPoint(e[o].layerLatLng).setMiddlePoints(this.wayPoints),r.push(n.request())}angular.injector(["ng"]).get("$q").all(r).then(function(e){for(var r=0;r<e.length;r++)i.push(t.routeProvider.parceResult(e[r].data));var o=i.sort(t.comFunction2);t.drawRoute(o[0][0])})},getElevenPoints:function(){for(var t=this.arrayOfMCAD(),e=[],i=0;i<t.length;i++)e.push({layerLatLng:t[i],distance:this.startPoint._latlng.distanceTo(t[i])});return e.sort(this.comFunction).slice(0,11)},comFunction:function(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:0},comFunction2:function(t,e){return t[0].distance<e[0].distance?-1:t[0].distance>e[0].distance?1:0},showMCADPoints:function(t){if("start"!==t.layer.options.routePoint){var e=this.arrayOfMCAD();this.mcadPoints=(new L.LayerGroup).addTo(this.map);for(var i=0;i<e.length;i++)this.mcadPoints.addLayer(new L.circleMarker(e[i],{color:"#E53935",weight:2,fillColor:"#E53935",fillOpacity:.4}))}},hideMCADPoints:function(){this.mcadPoints&&(this.mcadPoints.remove(),delete this.mcadPoints)},arrayOfMCAD:function(){for(var t=[],e=0;e<o.McadPoints.length;e++)t.push(new L.latLng(o.McadPoints[e][1],o.McadPoints[e][0]));return t}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.config={routingUrl:"http://188.134.5.249:3030/route/v1/driving/"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.McadPoints=[[37.370743963,55.7900346394],[37.378270044,55.7960801265],[37.3858805489,55.8090674539],[37.389455252,55.813351974],[37.3903679421,55.8159160498],[37.3919461355,55.8212680135],[37.3953893225,55.8333960946],[37.394925847,55.8319678193],[37.3956507702,55.8356785564],[37.392347022,55.8497441067],[37.3974159383,55.8591232043],[37.399958636,55.8625941994],[37.4031815731,55.8656151612],[37.4191322597,55.8738805922],[37.4258562192,55.8760086759],[37.4316175758,55.8778166554],[37.4439531536,55.8815563457],[37.4512047621,55.8827081777],[37.4862720291,55.8882668866],[37.4868139389,55.8884188401],[37.490236527,55.8895784658],[37.4949211944,55.8916017297],[37.4996557746,55.8936968563],[37.5481067871,55.9084475027],[37.5427946452,55.9078799665],[37.5708028243,55.910857441],[37.5818763228,55.9109853275],[37.5877874176,55.9101860305],[37.5935701654,55.908703291],[37.6295144706,55.8997257115],[37.6664142483,55.8956172896],[37.6715481304,55.8954200531],[37.682538441,55.8951108695],[37.6992520794,55.8940873477],[37.7073902333,55.8917043562],[37.7131420827,55.8891239499],[37.7249975475,55.8830294581],[37.730901512,55.8801391721],[37.8278463193,55.8302772253],[37.8301660734,55.8289422831],[37.8391218456,55.814708952],[37.8394926259,55.8111511412],[37.8396067122,55.8101895149],[37.8429437356,55.7779506079],[37.8433050088,55.7748493065],[37.8436282532,55.7707316803],[37.8434286022,55.7670200964],[37.8428771853,55.7553107823],[37.8423542899,55.7460542456],[37.8419930167,55.740777572],[37.8405205908,55.7291252899],[37.8390659908,55.7170578494],[37.8378966066,55.712804242],[37.836848439,55.7107997849],[37.8314293412,55.7005991606],[37.8314970799,55.6854640667],[37.8323455965,55.683124557],[37.8395686834,55.6574611634],[37.8387486884,55.6553452535],[37.8348982768,55.6505136313],[37.8273828438,55.6453112266],[37.8204948853,55.6408043314],[37.8180919433,55.6392267955],[37.7986117128,55.6264190387],[37.798233802,55.6261291856],[37.7809614181,55.6167931363],[37.7470088691,55.5989104603],[37.7396645655,55.5958352148],[37.7323202619,55.5927731589],[37.7219336578,55.588387825],[37.7191765729,55.5872863778],[37.703382755,55.5814025142],[37.6896686348,55.5762500511],[37.6838335975,55.5741539404],[37.6500117722,55.5726892838],[37.6382585097,55.5733745886],[37.6352780059,55.5735761466],[37.6193059282,55.574511362],[37.6028775054,55.575462679],[37.6003390859,55.575615855],[37.5903850589,55.576671947],[37.5739281146,55.5805735977],[37.5698923128,55.5815167072],[37.5298765539,55.5911157886],[37.5259976207,55.5920264108],[37.4967972401,55.6066901578],[37.4937525628,55.6093362997],[37.4890179826,55.6134038409],[37.4711563511,55.6283977433],[37.4677480238,55.6313805399],[37.4600614614,55.6377881553],[37.4568100027,55.640673655],[37.4524580869,55.6446769169],[37.4289135331,55.666142281],[37.4255979009,55.6706382181],[37.4170271699,55.6820607217],[37.4153016151,55.6853328693],[37.4109805977,55.6925354533],[37.400178054,55.7007653533],[37.3953079964,55.7043493189],[37.3908015888,55.7076959317],[37.3830651137,55.7185373097],[37.3796710471,55.7252358495],[37.3747653376,55.7346873495],[37.3729470877,55.7384889855],[37.3689089091,55.7629799824],[37.3690515169,55.7672802708],[37.369179864,55.7696949637],[37.3693224718,55.7733768817],[37.3756970421,55.7931762657]]},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.geoJSONService=e.GeoJSONService=void 0;var r=(i(4),i(20)),o=i(32),n=i(5);i(33);var s=e.GeoJSONService=L.GeoJSON.extend({initialize:function(t){L.setOptions(this,t),L.GeoJSON.prototype.initialize.call(this,null,t),this._provider=new o.GeoJSONProvider(t.dataUrl),this.filteredIds=[],this.featuresFlow=new n.Subject,this._processFeatures(),this.options.selectable&&(this.selections=new r.GeoJSONSelection(this.options.selectionOptions||{}))},setStyled:function(){return(void 0).styled=!0},removeStyles:function(){return(void 0).styled=!1},setLabeled:function(){return(void 0).labeled=!0},removeLabels:function(){return(void 0).labeled=!1},onAdd:function(t){this._map=t,L.GeoJSON.prototype.onAdd.call(this,t),this._updateData(),this._map.on("moveend",this._updateData,this)},onRemove:function(t){this.clearLayers(),L.GeoJSON.prototype.onRemove.call(this,t),t.off("moveend",this._updateData,this)},_updateData:function(t){var e=void 0;e=this.options.bounds||this.options.circle?this.options.bounds||this.options.circle:this._map.getBounds();var i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)return void this.clearLayers();this._updateDataByBounds(e)},_updateDataByBounds:function(t){var e=this;this._provider.getDataByBounds(t).map(function(t){return e.filterData(t)}).subscribe(function(t){return e.featuresFlow.next(t)},function(t){return e.clearLayers()})},_processFeatures:function(){var t=this;this.featuresFlow.map(function(e){return t._replaceData(e)}).subscribe()},filterData:function(t){var e=this;return t.features.filter(function(t){return-1===e.filteredIds.indexOf(t.properies.id)&&t})},_replaceData:function(t){if(this.clearLayers(),t){for(var e=t.length-1;e>=0;e--)this.addData(t[e]);this.subscribeOnSelection(),this._map.fire("layer:load")}},subscribeOnSelection:function(){var t=this;this.options.selectable&&(this.eachLayer(function(e){t.selections.isInSelections(e)&&t.selections.setSelectionStyle(e)}),this.on("click",this.selections.addSelections,this.selections),this._map.doubleClickZoom.disable(),this.on("dblclick",this.clearSelections,this))},clearSelections:function(){var t=this;this.eachLayer(function(e){t.selections.isInSelections(e)&&e.setStyle(e.beforeSelectionStyle)}),this.selections.clearSelections()},setFilteredIds:function(t){return(void 0).filteredIds=t,(void 0).stayOrRemoveViaFilteredIds()},stayOrRemoveViaFilteredIds:function(){(void 0).eachLayer(function(t){-1===(void 0).filteredIds.indexOf(t.feature.properies.zu_id)?t._path.style.visibility="hidden":"hidden"===t._path.style.visibility&&(t._path.style.visibility="visible")})},removeFilteredIds:function(){(void 0).filteredIds=[],(void 0)._updateData()}});e.geoJSONService=function(t){return new s(t)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GeoJSONSelection=void 0;var r=i(21);e.GeoJSONSelection=L.Class.extend({options:{multiple:!1,activeStyle:{weight:4,color:"#ff6d00"}},initialize:function(t){L.setOptions(this,t),this.tempSelectedFeature=new r.BehaviorSubject(!1),this.inSelectionsFeatureIds=new r.BehaviorSubject([])},addSelections:function(t){if(t){var e=t.layer||t;this.isInSelections(e)||(this.setSelectionStyle(e),this.options.multiple?this.inSelectionsFeatureIds.next([e.feature.properies.id]):this.inSelectionsFeatureIds.next(this.inSelectionsFeatureIds.getValue().concat([e.feature.properies.id])))}},setSelectionStyle:function(t){t.beforeSelectionStyle={weight:t.options.weight,color:t.options.color},t.setStyle(this.options.activeStyle)},isInSelections:function(t){return this.inSelectionsFeatureIds.getValue().filter(function(e){return e===t.feature.properies.id}).length>0},clearSelections:function(){this.inSelectionsFeatureIds.next([])},setTempFeature:function(t){var e=this;if(t){var i=t.layer||t,r={weight:i.options.weight,color:i.options.color};i.setStyle(this.options.activeStyle),this.tempSelectedFeature.next(i),setTimeout(function(){return e.tempSelectedFeature.getValue().setStyle(r)},3236)}}})},function(t,e,i){"use strict";var r=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(5),n=i(10),s=function(t){function e(e){t.call(this),this._value=e}return r(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var i=t.prototype._subscribe.call(this,e);return i&&!i.closed&&e.next(this._value),i},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new n.ObjectUnsubscribedError;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(o.Subject);e.BehaviorSubject=s},function(t,e,i){"use strict";var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"===("undefined"==typeof window?"undefined":o(window))&&(r=window)}t.exports=r},function(t,e,i){"use strict";function r(t,e,i){if(t){if(t instanceof o.Subscriber)return t;if(t[n.rxSubscriber])return t[n.rxSubscriber]()}return t||e||i?new o.Subscriber(t,e,i):new o.Subscriber(s.empty)}var o=i(1),n=i(3),s=i(9);e.toSubscriber=r},function(t,e,i){"use strict";e.isArray=Array.isArray||function(t){return t&&"number"==typeof t.length}},function(t,e,i){"use strict";function r(t){return null!=t&&"object"===(void 0===t?"undefined":o(t))}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.isObject=r},function(t,e,i){"use strict";function r(){try{return n.apply(this,arguments)}catch(t){return s.errorObject.e=t,s.errorObject}}function o(t){return n=t,r}var n,s=i(8);e.tryCatch=o},function(t,e,i){"use strict";var r=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=function(t){function e(e){t.call(this),this.errors=e;var i=Error.call(this,e?e.length+" errors occurred during unsubscription:\n  "+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"");this.name=i.name="UnsubscriptionError",this.stack=i.stack,this.message=i.message}return r(e,t),e}(Error);e.UnsubscriptionError=o},function(t,e,i){"use strict";function r(t){var e,i=t.Symbol;return"function"==typeof i?i.observable?e=i.observable:(e=i("observable"),i.observable=e):e="@@observable",e}var o=i(0);e.getSymbolObservable=r,e.observable=r(o.root),e.$$observable=e.observable},function(t,e,i){"use strict";function r(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return o(t)}function o(t){return t?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:n.noop}var n=i(30);e.pipe=r,e.pipeFromArray=o},function(t,e,i){"use strict";function r(){}e.noop=r},function(t,e,i){"use strict";var r=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(2),n=function(t){function e(e,i){t.call(this),this.subject=e,this.subscriber=i,this.closed=!1}return r(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var i=e.indexOf(this.subscriber);-1!==i&&e.splice(i,1)}}},e}(o.Subscription);e.SubjectSubscription=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GeoJSONProvider=L.Class.extend({initialize:function(t){if(!t)throw new Error("Не задан url для GeoJSONProvider");this.dataUrl=t},getDataByBounds:function(t,e,i){var r={};return t instanceof L.LatLngBounds?r.bbox=this._getMinMaxBounds(t):r.bbox=t,r.labeled=e||!1,r.styled=i||!1,TDMap.Utils.Promises.getPromise(this.dataUrl,r)},_getMinMaxBounds:function(t){var e=t.getNorthWest(),i=t.getSouthEast();return[e.lng,i.lat,i.lng,e.lat].toString()}})},function(t,e,i){"use strict";var r=i(6),o=i(34);r.Observable.prototype.map=o.map},function(t,e,i){"use strict";function r(t,e){return o.map(t,e)(this)}var o=i(35);e.map=r},function(t,e,i){"use strict";function r(t,e){return function(i){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new s(t,e))}}var o=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},n=i(1);e.map=r;var s=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new a(t,this.project,this.thisArg))},t}();e.MapOperator=s;var a=function(t){function e(e,i,r){t.call(this,e),this.project=i,this.count=0,this.thisArg=r||this}return o(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(n.Subscriber)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),L.GridLayer.GoogleMutant=L.GridLayer.extend({options:{minZoom:0,maxZoom:23,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,type:"roadmap",maxNativeZoom:21},initialize:function(t){L.GridLayer.prototype.initialize.call(this,t),this._ready=!!window.google&&!!window.google.maps&&!!window.google.maps.Map,this._GAPIPromise=this._ready?Promise.resolve(window.google):new Promise(function(t,e){var i=0,r=null;r=setInterval(function(){return i>=10?(clearInterval(r),e(new Error("window.google not found after 10 attempts"))):window.google&&window.google.maps&&window.google.maps.Map?(clearInterval(r),t(window.google)):void i++},500)}),this._tileCallbacks={},this._freshTiles={},this._imagesPerTile="hybrid"===this.options.type?2:1},onAdd:function(t){L.GridLayer.prototype.onAdd.call(this,t),this._initMutantContainer(),this._GAPIPromise.then(function(){if(this._ready=!0,this._map=t,this._initMutant(),t.on("viewreset",this._reset,this),t.on("move",this._update,this),t.on("zoomend",this._handleZoomAnim,this),t.on("resize",this._resize,this),google.maps.event.addListenerOnce(this._mutant,"idle",function(){this._checkZoomLevels(),this._mutantIsReady=!0}.bind(this)),t._controlCorners.bottomright.style.marginBottom="20px",t._controlCorners.bottomleft.style.marginBottom="20px",this._reset(),this._update(),this._subLayers)for(var e in this._subLayers)this._subLayers[e].setMap(this._mutant)}.bind(this))},onRemove:function(t){L.GridLayer.prototype.onRemove.call(this,t),t._container.removeChild(this._mutantContainer),this._mutantContainer=void 0,google.maps.event.clearListeners(t,"idle"),google.maps.event.clearListeners(this._mutant,"idle"),t.off("viewreset",this._reset,this),t.off("move",this._update,this),t.off("zoomend",this._handleZoomAnim,this),t.off("resize",this._resize,this),t._controlCorners&&(t._controlCorners.bottomright.style.marginBottom="0em",t._controlCorners.bottomleft.style.marginBottom="0em")},getAttribution:function(){return this.options.attribution},setOpacity:function(t){this.options.opacity=t,t<1&&L.DomUtil.setOpacity(this._mutantContainer,t)},setElementSize:function(t,e){t.style.width=e.x+"px",t.style.height=e.y+"px"},addGoogleLayer:function(t,e){return this._subLayers||(this._subLayers={}),this._GAPIPromise.then(function(){var i=google.maps[t],r=new i(e);return r.setMap(this._mutant),this._subLayers[t]=r,r}.bind(this))},removeGoogleLayer:function(t){var e=this._subLayers&&this._subLayers[t];e&&(e.setMap(null),delete this._subLayers[t])},_initMutantContainer:function(){this._mutantContainer||(this._mutantContainer=L.DomUtil.create("div","leaflet-google-mutant leaflet-top leaflet-left"),this._mutantContainer.id="_MutantContainer_"+L.Util.stamp(this._mutantContainer),this._mutantContainer.style.zIndex="800",this._mutantContainer.style.pointerEvents="none",this._map.getContainer().appendChild(this._mutantContainer)),this.setOpacity(this.options.opacity),this.setElementSize(this._mutantContainer,this._map.getSize()),this._attachObserver(this._mutantContainer)},_initMutant:function(){if(this._ready&&this._mutantContainer){this._mutantCenter=new google.maps.LatLng(0,0);var t=new google.maps.Map(this._mutantContainer,{center:this._mutantCenter,zoom:0,tilt:0,mapTypeId:this.options.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.styles||{},backgroundColor:"transparent"});this._mutant=t,google.maps.event.addListenerOnce(t,"idle",function(){for(var t=this._mutantContainer.querySelectorAll("a"),e=0;e<t.length;e++)t[e].style.pointerEvents="auto"}.bind(this)),this.fire("spawned",{mapObject:t})}},_attachObserver:function(t){new MutationObserver(this._onMutations.bind(this)).observe(t,{childList:!0,subtree:!0})},_onMutations:function(t){for(var e=0;e<t.length;++e)for(var i=t[e],r=0;r<i.addedNodes.length;++r){var o=i.addedNodes[r];o instanceof HTMLImageElement?this._onMutatedImage(o):o instanceof HTMLElement&&Array.prototype.forEach.call(o.querySelectorAll("img"),this._onMutatedImage.bind(this))}},_roadRegexp:/!1i(\d+)!2i(\d+)!3i(\d+)!/,_satRegexp:/x=(\d+)&y=(\d+)&z=(\d+)/,_staticRegExp:/StaticMapService\.GetMapImage/,_onMutatedImage:function(t){var e,i=t.src.match(this._roadRegexp),r=0;if(i?(e={z:i[1],x:i[2],y:i[3]},this._imagesPerTile>1&&(t.style.zIndex=1,r=1)):(i=t.src.match(this._satRegexp),i&&(e={x:i[1],y:i[2],z:i[3]}),r=0),e){var o=this._tileCoordsToKey(e);t.style.position="absolute",t.style.visibility="hidden";var n=o+"/"+r;if(this._freshTiles[n]=t,n in this._tileCallbacks&&this._tileCallbacks[n])this._tileCallbacks[n].pop()(t),this._tileCallbacks[n].length||delete this._tileCallbacks[n];else if(this._tiles[o]){var s=this._tiles[o].el,a=0===r?s.firstChild:s.firstChild.nextSibling,l=this._clone(t);s.replaceChild(l,a)}}else t.src.match(this._staticRegExp)&&(t.style.visibility="hidden")},createTile:function(t,e){var i=this._tileCoordsToKey(t),r=L.DomUtil.create("div");r.dataset.pending=this._imagesPerTile,e=e.bind(this,null,r);for(var o=0;o<this._imagesPerTile;o++){var n=i+"/"+o;if(n in this._freshTiles){var s=this._freshTiles[n];r.appendChild(this._clone(s)),r.dataset.pending--}else this._tileCallbacks[n]=this._tileCallbacks[n]||[],this._tileCallbacks[n].push(function(t){return function(i){t.appendChild(this._clone(i)),t.dataset.pending--,parseInt(t.dataset.pending)||e()}.bind(this)}.bind(this)(r))}return parseInt(r.dataset.pending)||L.Util.requestAnimFrame(e),r},_clone:function(t){var e=t.cloneNode(!0);return e.style.visibility="visible",e},_checkZoomLevels:function(){var t=this._map.getZoom(),e=this._mutant.getZoom();t&&e&&(e!==t||e>this.options.maxNativeZoom)&&this._setMaxNativeZoom(e)},_setMaxNativeZoom:function(t){t!=this.options.maxNativeZoom&&(this.options.maxNativeZoom=t,this._resetView())},_reset:function(){this._initContainer()},_update:function(){if(this._mutant){var t=this._map.getCenter(),e=new google.maps.LatLng(t.lat,t.lng);this._mutant.setCenter(e);var i=this._map.getZoom(),r=i!==Math.round(i),o=this._mutant.getZoom();r||i==o||(this._mutant.setZoom(i),this._mutantIsReady&&this._checkZoomLevels())}L.GridLayer.prototype._update.call(this)},_resize:function(){var t=this._map.getSize();this._mutantContainer.style.width===t.x&&this._mutantContainer.style.height===t.y||(this.setElementSize(this._mutantContainer,t),this._mutant&&google.maps.event.trigger(this._mutant,"resize"))},_handleZoomAnim:function(){if(this._mutant){var t=this._map.getCenter(),e=new google.maps.LatLng(t.lat,t.lng);this._mutant.setCenter(e),this._mutant.setZoom(Math.round(this._map.getZoom()))}},_removeTile:function(t){if(this._mutant)return setTimeout(this._pruneTile.bind(this,t),1e3),L.GridLayer.prototype._removeTile.call(this,t)},_pruneTile:function(t){for(var e=this._mutant.getZoom(),i=t.split(":")[2],r=this._mutant.getBounds(),o=r.getSouthWest(),n=r.getNorthEast(),s=L.latLngBounds([[o.lat(),o.lng()],[n.lat(),n.lng()]]),a=0;a<this._imagesPerTile;a++){var l=t+"/"+a;if(l in this._freshTiles){var u=this._map&&this._keyToBounds(t);this._map&&u.overlaps(s)&&i==e||delete this._freshTiles[l]}}}}),L.gridLayer.googleMutant=function(t){return new L.GridLayer.GoogleMutant(t)},e.GoogleProvider=L.GridLayer.GoogleMutant},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.YandexProvider=L.Layer.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,attribution:"",opacity:1,traffic:!1},possibleShortMapTypes:{schemaMap:"map",satelliteMap:"satellite",hybridMap:"hybrid",publicMap:"publicMap",publicMapInHybridView:"publicMapHybrid"},_getPossibleMapType:function(t){var e="yandex#map";if("string"!=typeof t)return e;for(var i in this.possibleShortMapTypes){if(t===this.possibleShortMapTypes[i]){e="yandex#"+t;break}t==="yandex#"+this.possibleShortMapTypes[i]&&(e=t)}return e},initialize:function(t,e){L.Util.setOptions(this,e),this._type=this._getPossibleMapType(t)},onAdd:function(t,e){this._map=t,this._insertAtTheBottom=e,this._initContainer(),this._initMapObject(),t.on("viewreset",this._reset,this),this._limitedUpdate=L.Util.throttle(this._update,1,this),t.on("move",this._update,this),t._controlCorners.bottomright.style.marginBottom="3em",this._reset(),this._update(!0)},onRemove:function(t){this._map._container.removeChild(this._container),this._map.off("viewreset",this._reset,this),this._map.off("move",this._update,this),t._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(t){this.options.opacity=t,t<1&&L.DomUtil.setOpacity(this._container,t)},setElementSize:function(t,e){t.style.width=e.x+"px",t.style.height=e.y+"px"},_initContainer:function(){var t=this._map._container,e=t.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-yandex-layer leaflet-top leaflet-left"),this._container.id="_YMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),this.options.overlay&&(e=this._map._container.getElementsByClassName("leaflet-map-pane")[0],e=e.nextSibling,L.Browser.opera&&(this._container.className+=" leaflet-objects-pane")),t.insertBefore(this._container,e),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(!this._yandex){if(void 0===ymaps.Map)return ymaps.load(["package.map"],this._initMapObject,this);if(this.options.traffic&&(void 0===ymaps.control||void 0===ymaps.control.TrafficControl))return ymaps.load(["package.traffic","package.controls"],this._initMapObject,this);var t=new ymaps.Map(this._container,{center:[0,0],zoom:0,behaviors:[],controls:[]});this.options.traffic&&t.controls.add(new ymaps.control.TrafficControl({shown:!0})),"yandex#null"===this._type&&(this._type=new ymaps.MapType("null",[]),t.container.getElement().style.background="transparent"),t.setType(this._type),this._yandex=t,this._update(!0),this.fire("MapObjectInitialized",{mapObject:t})}},_reset:function(){this._initContainer()},_update:function(t){if(this._yandex){this._resize(t);var e=this._map.getCenter(),i=[e.lat,e.lng];this._yandex.setCenter(i),void 0!==this._map.getZoom()&&this._yandex.setZoom(Math.round(this._map.getZoom()))}},_resize:function(t){var e=this._map.getSize(),i=this._container.style;i.width===e.x+"px"&&i.height===e.y+"px"&&!0!==t||(this.setElementSize(this._container,e),this._yandex.container.fitToViewport())}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=L.TileLayer.extend({options:{tileSize:256,dpi:96,f:"image",transparent:!0,format:"png32",bboxSR:"3857",imageSR:"3857"},_needInitInteraction:!0,getTileUrl:function(t){var e=this._map,i=e.options.crs,r=this.options.tileSize,o=t.multiplyBy(r),n=o.add([r,r]),s=i.project(e.unproject(o,t.z)),a=i.project(e.unproject(n,t.z)),l=[s.x,a.y,a.x,s.y].join(","),u=L.Util.getParamString({bbox:l,dpi:this.options.dpi,f:this.options.f,transparent:this.options.transparent,format:this.options.format,bboxSR:this.options.bboxSR,imageSR:this.options.imageSR,size:this.options.tileSize+","+this.options.tileSize,layers:this.options.layers},this._url);return this._url+u},onAdd:function(t){L.TileLayer.prototype.onAdd.call(this,t),this.options.clickable&&(L.DomUtil.addClass(this._container,"leaflet-clickable-raster-layer"),this._needInitInteraction&&(this._initInteraction(),this._needInitInteraction=!1))},_initInteraction:function(){for(var t=this._container,e=["dblclick","click","mousedown","mouseover","mouseout","contextmenu"],i=0;i<e.length;i++)L.DomEvent.on(t,e[i],this._fireMouseEvent,this)},_fireMouseEvent:function(t){var e=this._map;if(!e.dragging||!e.dragging.moved()){var i=e.mouseEventToContainerPoint(t),r=e.containerPointToLayerPoint(i),o=e.layerPointToLatLng(r);this.fire(t.type,{latlng:o,layerPoint:r,containerPoint:i,originalEvent:t})}}});L.tileLayer.rosreestr=function(t,e){return new r(t,e)},e.RosreestrProvider=r},function(t,e,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();e.Manager=function(){function t(e){r(this,t),this.options=e,this.createLeafletMap(e.mapDivId||"map",e.center||[60,30],e.zoom||12,e.zoomControl||!1,e.editable||!1),e.memorize&&this.restoreMapPosition()}return o(t,[{key:"createLeafletMap",value:function(t,e,i,r,o){this._map=L.map(t,{editable:o,center:e,zoom:i,zoomControl:r})}},{key:"restoreMapPosition",value:function(){var t=this,e=void 0,i=void 0,r=void 0,o=window.localStorage.getItem("MAP_STATE_ZOOM"),n=window.localStorage.getItem("MAP_STATE_COORDINATES_LAT"),s=window.localStorage.getItem("MAP_STATE_COORDINATES_LNG");o&&(e=Number(o)),n&&s&&(i=Number(n),r=Number(s)),e&&i&&r&&this._map.setView([i,r],e);var a=function(){window.localStorage.setItem("MAP_STATE_ZOOM",t._map.getZoom()),window.localStorage.setItem("MAP_STATE_COORDINATES_LAT",t._map.getCenter().lat),window.localStorage.setItem("MAP_STATE_COORDINATES_LNG",t._map.getCenter().lng)};window.addEventListener("beforeunload",a)}},{key:"updateMapPosition",value:function(t,e){return this._map.setView(t,e),this}}]),t}()}]);